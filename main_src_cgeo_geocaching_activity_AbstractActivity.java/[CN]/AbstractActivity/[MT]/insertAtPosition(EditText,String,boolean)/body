{
  int selectionStart=editText.getSelectionStart();
  int selectionEnd=editText.getSelectionEnd();
  int start=Math.min(selectionStart,selectionEnd);
  int end=Math.max(selectionStart,selectionEnd);
  final String content=editText.getText().toString();
  String completeText;
  if (start > 0 && !Character.isWhitespace(content.charAt(start - 1))) {
    completeText=" " + insertText;
  }
 else {
    completeText=insertText;
  }
  editText.getText().replace(start,end,completeText);
  int newCursor=moveCursor ? start + completeText.length() : start;
  editText.setSelection(newCursor,newCursor);
}
