{
  final Pattern pattern=LatLon.LAT == latlon ? patternLat : patternLon;
  final Matcher matcher=pattern.matcher(text);
  if (matcher.find()) {
    final int sign=matcher.group(1).equalsIgnoreCase("S") || matcher.group(1).equalsIgnoreCase("W") ? -1 : 1;
    final int degree=Integer.parseInt(matcher.group(2));
    int minutes=0;
    double seconds=0;
    if (null != matcher.group(3)) {
      minutes=Integer.parseInt(matcher.group(3));
      if (null != matcher.group(4)) {
        seconds=Double.parseDouble("0." + matcher.group(4)) * 60;
      }
 else       if (null != matcher.group(5)) {
        seconds=Double.parseDouble(matcher.group(5));
      }
    }
    return (double)sign * ((double)degree + (double)minutes / 60 + seconds / 3600);
  }
 else {
    try {
      final String[] items=StringUtils.split(text.trim());
      if (items.length > 0) {
        final int index=latlon == LatLon.LON ? items.length - 1 : 0;
        return Double.parseDouble(items[index]);
      }
    }
 catch (    NumberFormatException e) {
    }
  }
  throw new ParseException("Could not parse coordinates as " + latlon + ": \""+ text+ "\"",latlon);
}
