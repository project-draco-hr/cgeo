{
  if (MapUtils.isEmpty(calendars)) {
    return;
  }
  try {
    Uri calendarProvider=Compatibility.getCalenderEventsProviderURI();
    final Integer[] keys=calendars.keySet().toArray(new Integer[calendars.size()]);
    final Integer calId=keys[index];
    final Date eventDate=cache.getHiddenDate();
    eventDate.setHours(0);
    eventDate.setMinutes(0);
    eventDate.setSeconds(0);
    StringBuilder description=new StringBuilder();
    description.append(cache.getUrl());
    if (StringUtils.isNotBlank(cache.getShortdesc())) {
      Spanned spanned=Html.fromHtml(cache.getShortdesc(),null,null);
      String text=spanned.toString();
      ImageSpan[] spans=spanned.getSpans(0,spanned.length(),ImageSpan.class);
      for (int i=spans.length - 1; i >= 0; i--) {
        text=StringUtils.left(text,spanned.getSpanStart(spans[i]) - 1) + StringUtils.substring(text,spanned.getSpanEnd(spans[i]) + 1);
      }
      if (StringUtils.isNotBlank(text)) {
        description.append("\n\n");
        description.append(text);
      }
    }
    if (StringUtils.isNotBlank(cache.getPersonalNote())) {
      description.append("\n\n").append(Html.fromHtml(cache.getPersonalNote()).toString());
    }
    ContentValues event=new ContentValues();
    event.put("calendar_id",calId);
    event.put("dtstart",eventDate.getTime() + 43200000);
    event.put("dtend",eventDate.getTime() + 43200000 + 3600000);
    event.put("eventTimezone","UTC");
    event.put("title",Html.fromHtml(cache.getName()).toString());
    event.put("description",description.toString());
    StringBuilder location=new StringBuilder();
    if (cache.getCoords() != null) {
      location.append(cache.getCoords().format(GeopointFormatter.Format.LAT_LON_DECMINUTE_RAW));
    }
    if (StringUtils.isNotBlank(cache.getLocation())) {
      boolean addParentheses=false;
      if (location.length() > 0) {
        addParentheses=true;
        location.append(" (");
      }
      location.append(Html.fromHtml(cache.getLocation()).toString());
      if (addParentheses) {
        location.append(')');
      }
    }
    if (location.length() > 0) {
      event.put("eventLocation",location.toString());
    }
    event.put("allDay",1);
    event.put("hasAlarm",0);
    getContentResolver().insert(calendarProvider,event);
    showToast(res.getString(R.string.event_success));
  }
 catch (  Exception e) {
    showToast(res.getString(R.string.event_fail));
    Log.e(Settings.tag,"CacheDetailActivity.addToCalendarFn: " + e.toString());
  }
}
