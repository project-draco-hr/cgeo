{
  super.onCreate(savedInstanceState);
  setTheme();
  setContentView(R.layout.cacheview);
  setTitle(res.getString(R.string.cache));
  String geocode=null;
  String guid=null;
  String name=null;
  if (search != null) {
    cache=search.getFirstCacheFromResult(LoadFlags.LOAD_ALL_DB_ONLY);
    if (cache != null && cache.getGeocode() != null) {
      geocode=cache.getGeocode();
    }
  }
  final Bundle extras=getIntent().getExtras();
  final Uri uri=getIntent().getData();
  if (geocode == null && extras != null) {
    geocode=extras.getString("geocode");
    name=extras.getString("name");
    guid=extras.getString("guid");
  }
  if (geocode == null && guid == null && uri != null) {
    String uriHost=uri.getHost().toLowerCase();
    String uriPath=uri.getPath().toLowerCase();
    String uriQuery=uri.getQuery();
    if (uriQuery != null) {
      Log.i("Opening URI: " + uriHost + uriPath+ "?"+ uriQuery);
    }
 else {
      Log.i("Opening URI: " + uriHost + uriPath);
    }
    if (uriHost.contains("geocaching.com")) {
      geocode=uri.getQueryParameter("wp");
      guid=uri.getQueryParameter("guid");
      if (StringUtils.isNotBlank(geocode)) {
        geocode=geocode.toUpperCase();
        guid=null;
      }
 else       if (StringUtils.isNotBlank(guid)) {
        geocode=null;
        guid=guid.toLowerCase();
      }
 else {
        showToast(res.getString(R.string.err_detail_open));
        finish();
        return;
      }
    }
 else     if (uriHost.contains("coord.info")) {
      if (uriPath != null && uriPath.startsWith("/gc")) {
        geocode=uriPath.substring(1).toUpperCase();
      }
 else {
        showToast(res.getString(R.string.err_detail_open));
        finish();
        return;
      }
    }
  }
  if (geocode == null && guid == null) {
    showToast(res.getString(R.string.err_detail_cache));
    finish();
    return;
  }
  final LoadCacheHandler loadCacheHandler=new LoadCacheHandler();
  try {
    String title=res.getString(R.string.cache);
    if (StringUtils.isNotBlank(name)) {
      title=name;
    }
 else     if (null != geocode && StringUtils.isNotBlank(geocode)) {
      title=geocode.toUpperCase();
    }
    progress.show(this,title,res.getString(R.string.cache_dialog_loading_details),true,loadCacheHandler.cancelMessage());
  }
 catch (  Exception e) {
  }
  ImageView defaultNavigationImageView=(ImageView)findViewById(R.id.defaultNavigation);
  defaultNavigationImageView.setOnLongClickListener(new OnLongClickListener(){
    @Override public boolean onLongClick(    View v){
      startDefaultNavigation2();
      return true;
    }
  }
);
  viewPager=(ViewPager)findViewById(R.id.viewpager);
  viewPagerAdapter=new ViewPagerAdapter();
  viewPager.setAdapter(viewPagerAdapter);
  titleIndicator=(TitlePageIndicator)findViewById(R.id.pager_indicator);
  titleIndicator.setViewPager(viewPager);
  titleIndicator.setOnPageChangeListener(new OnPageChangeListener(){
    @Override public void onPageSelected(    int position){
      if (Settings.isOpenLastDetailsPage()) {
        Settings.setLastDetailsPage(position);
      }
    }
    @Override public void onPageScrolled(    int position,    float positionOffset,    int positionOffsetPixels){
    }
    @Override public void onPageScrollStateChanged(    int state){
    }
  }
);
  int entryPageIndex;
  if (extras != null && extras.get("page") != null) {
    entryPageIndex=extras.getInt("page");
  }
 else {
    entryPageIndex=Settings.isOpenLastDetailsPage() ? Settings.getLastDetailsPage() : 1;
    if (viewPagerAdapter.getCount() < entryPageIndex) {
      for (int i=0; i <= entryPageIndex; i++) {
        pageOrder.add(null);
      }
    }
  }
  viewPager.setCurrentItem(entryPageIndex,false);
  new LoadCacheThread(geocode,guid,loadCacheHandler).start();
}
