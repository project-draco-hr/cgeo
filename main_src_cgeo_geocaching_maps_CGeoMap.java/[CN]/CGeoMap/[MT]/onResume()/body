{
  super.onResume();
  if (changeMapSource(Settings.getMapSource())) {
    return;
  }
  app.setAction(StringUtils.defaultIfBlank(geocodeIntent,null));
  if (geo == null) {
    geo=app.startGeo(geoUpdate);
  }
  if (Settings.isUseCompass() && dir == null) {
    dir=app.startDir(activity,dirUpdate);
  }
  geoUpdate.updateLocation(geo);
  if (dir != null) {
    dirUpdate.updateDirection(dir);
  }
  if (!CollectionUtils.isEmpty(dirtyCaches)) {
    for (    String geocode : dirtyCaches) {
      cgCache cache=app.loadCache(geocode,LoadFlags.LOAD_WAYPOINTS);
      caches.remove(cache);
      caches.add(cache);
    }
    dirtyCaches.clear();
    GeoPointImpl mapCenterNow=mapView.getMapViewCenter();
    int centerLatitudeNow=mapCenterNow.getLatitudeE6();
    int centerLongitudeNow=mapCenterNow.getLongitudeE6();
    int spanLatitudeNow=mapView.getLatitudeSpan();
    int spanLongitudeNow=mapView.getLongitudeSpan();
    displayExecutor.execute(new DisplayRunnable(centerLatitudeNow,centerLongitudeNow,spanLatitudeNow,spanLongitudeNow));
  }
  startTimer();
}
