{
  if (cache != null) {
    final CachesOverlayItemImpl item=mapItemFactory.getCachesOverlayItem(coord,cache.getType());
    final int hashcode=new HashCodeBuilder().append(cache.isReliableLatLon()).append(cache.getType().id).append(cache.isDisabled() || cache.isArchived()).append(cache.getCacheRealm().id).append(cache.isOwn()).append(cache.isFound()).append(cache.hasUserModifiedCoords()).append(cache.getPersonalNote()).append(cache.isLogOffline()).append(cache.getListId() > 0).toHashCode();
    final LayerDrawable ldFromCache=overlaysCache.get(hashcode);
    if (ldFromCache != null) {
      item.setMarker(ldFromCache);
      return item;
    }
    final ArrayList<Drawable> layers=new ArrayList<Drawable>(9);
    final ArrayList<int[]> insets=new ArrayList<int[]>(8);
    final Drawable marker=getResources().getDrawable(cache.isDisabled() || cache.isArchived() ? cache.getCacheRealm().markerDisabledId : cache.getCacheRealm().markerId);
    layers.add(marker);
    final int resolution=marker.getIntrinsicWidth() > 40 ? 1 : 0;
    if (!cache.isReliableLatLon()) {
      insets.add(INSET_RELIABLE[resolution]);
      layers.add(getResources().getDrawable(R.drawable.marker_notreliable));
    }
    layers.add(getResources().getDrawable(cache.getType().markerId));
    insets.add(INSET_TYPE[resolution]);
    if (cache.isOwn()) {
      layers.add(getResources().getDrawable(R.drawable.marker_own));
      insets.add(INSET_OWN[resolution]);
    }
 else     if (cache.getListId() > 0) {
      layers.add(getResources().getDrawable(R.drawable.marker_stored));
      insets.add(INSET_OWN[resolution]);
    }
    if (cache.isFound()) {
      layers.add(getResources().getDrawable(R.drawable.marker_found));
      insets.add(INSET_FOUND[resolution]);
    }
 else     if (cache.isLogOffline()) {
      layers.add(getResources().getDrawable(R.drawable.marker_found_offline));
      insets.add(INSET_FOUND[resolution]);
    }
    if (cache.hasUserModifiedCoords()) {
      layers.add(getResources().getDrawable(R.drawable.marker_usermodifiedcoords));
      insets.add(INSET_USERMODIFIEDCOORDS[resolution]);
    }
    if (cache.getPersonalNote() != null) {
      layers.add(getResources().getDrawable(R.drawable.marker_personalnote));
      insets.add(INSET_PERSONALNOTE[resolution]);
    }
    final LayerDrawable ld=new LayerDrawable(layers.toArray(new Drawable[layers.size()]));
    int index=1;
    for (    final int[] inset : insets) {
      ld.setLayerInset(index++,inset[0],inset[1],inset[2],inset[3]);
    }
    overlaysCache.put(hashcode,ld);
    item.setMarker(ld);
    return item;
  }
  if (waypoint != null) {
    final CachesOverlayItemImpl item=mapItemFactory.getCachesOverlayItem(coord,null);
    Drawable[] layers=new Drawable[2];
    layers[0]=getResources().getDrawable(R.drawable.marker);
    layers[1]=getResources().getDrawable(waypoint.getWaypointType().markerId);
    LayerDrawable ld=new LayerDrawable(layers);
    if (layers[0].getIntrinsicWidth() > 40) {
      ld.setLayerInset(1,9,12,10,13);
    }
 else {
      ld.setLayerInset(1,9,12,8,12);
    }
    item.setMarker(ld);
    return item;
  }
  return null;
}
