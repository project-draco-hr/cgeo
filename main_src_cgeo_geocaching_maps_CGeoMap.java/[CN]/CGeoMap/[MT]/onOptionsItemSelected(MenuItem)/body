{
  final int id=item.getItemId();
switch (id) {
case MENU_TRAIL_MODE:
    Settings.setMapTrail(!Settings.isMapTrail());
  mapView.repaintRequired(overlayPosition);
ActivityMixin.invalidateOptionsMenu(activity);
return true;
case MENU_MAP_LIVE:
isLiveEnabled=!isLiveEnabled;
if (mapMode == MapMode.LIVE) {
Settings.setLiveMap(isLiveEnabled);
}
liveChanged=true;
lastSearchResult=null;
searchIntent=null;
ActivityMixin.invalidateOptionsMenu(activity);
return true;
case MENU_STORE_CACHES:
if (!isLoading()) {
final Set<String> geocodesInViewport=getGeocodesForCachesInViewport();
final List<String> geocodes=new ArrayList<String>();
for (final String geocode : geocodesInViewport) {
if (!cgData.isOffline(geocode,null)) {
geocodes.add(geocode);
}
}
detailTotal=geocodes.size();
detailProgress=0;
if (detailTotal == 0) {
ActivityMixin.showToast(activity,res.getString(R.string.warn_save_nothing));
return true;
}
if (Settings.getChooseList()) {
new StoredList.UserInterface(activity).promptForListSelection(R.string.list_title,new RunnableWithArgument<Integer>(){
@Override public void run(final Integer selectedListId){
storeCaches(geocodes,selectedListId);
}
}
,true,StoredList.TEMPORARY_LIST_ID);
}
 else {
storeCaches(geocodes,StoredList.STANDARD_LIST_ID);
}
}
return true;
case MENU_CIRCLE_MODE:
if (overlayCaches == null) {
return false;
}
overlayCaches.switchCircles();
mapView.repaintRequired(overlayCaches);
ActivityMixin.invalidateOptionsMenu(activity);
return true;
case MENU_THEME_MODE:
selectMapTheme();
return true;
case MENU_AS_LIST:
{
cgeocaches.startActivityMap(activity,new SearchResult(getGeocodesForCachesInViewport()));
return true;
}
case MENU_STRATEGY_FASTEST:
{
item.setChecked(true);
Settings.setLiveMapStrategy(Strategy.FASTEST);
return true;
}
case MENU_STRATEGY_FAST:
{
item.setChecked(true);
Settings.setLiveMapStrategy(Strategy.FAST);
return true;
}
case MENU_STRATEGY_AUTO:
{
item.setChecked(true);
Settings.setLiveMapStrategy(Strategy.AUTO);
return true;
}
case MENU_STRATEGY_DETAILED:
{
item.setChecked(true);
Settings.setLiveMapStrategy(Strategy.DETAILED);
return true;
}
default :
final MapSource mapSource=MapProviderFactory.getMapSource(id);
if (mapSource != null) {
item.setChecked(true);
changeMapSource(mapSource);
return true;
}
}
return false;
}
