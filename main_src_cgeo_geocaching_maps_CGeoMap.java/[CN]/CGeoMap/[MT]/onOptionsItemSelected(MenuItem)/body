{
  final int id=item.getItemId();
switch (id) {
case android.R.id.home:
    ActivityMixin.navigateUp(activity);
  return true;
case R.id.menu_trail_mode:
Settings.setMapTrail(!Settings.isMapTrail());
mapView.repaintRequired(overlayPositionAndScale);
ActivityMixin.invalidateOptionsMenu(activity);
return true;
case R.id.menu_map_live:
isLiveEnabled=!isLiveEnabled;
if (mapMode == MapMode.LIVE) {
Settings.setLiveMap(isLiveEnabled);
}
markersInvalidated=true;
lastSearchResult=null;
searchIntent=null;
ActivityMixin.invalidateOptionsMenu(activity);
return true;
case R.id.menu_store_caches:
if (!isLoading()) {
final Set<String> geocodesInViewport=getGeocodesForCachesInViewport();
final List<String> geocodes=new ArrayList<>();
for (final String geocode : geocodesInViewport) {
if (!DataStore.isOffline(geocode,null)) {
geocodes.add(geocode);
}
}
detailTotal=geocodes.size();
detailProgress=0;
if (detailTotal == 0) {
ActivityMixin.showToast(activity,res.getString(R.string.warn_save_nothing));
return true;
}
if (Settings.getChooseList()) {
new StoredList.UserInterface(activity).promptForListSelection(R.string.list_title,new Action1<Integer>(){
@Override public void call(final Integer selectedListId){
storeCaches(geocodes,selectedListId);
}
}
,true,StoredList.TEMPORARY_LIST.id);
}
 else {
storeCaches(geocodes,StoredList.STANDARD_LIST_ID);
}
}
return true;
case R.id.menu_circle_mode:
overlayCaches.switchCircles();
mapView.repaintRequired(overlayCaches);
ActivityMixin.invalidateOptionsMenu(activity);
return true;
case R.id.menu_mycaches_mode:
Settings.setExcludeMine(!Settings.isExcludeMyCaches());
markersInvalidated=true;
ActivityMixin.invalidateOptionsMenu(activity);
if (!Settings.isExcludeMyCaches()) {
Tile.cache.clear();
}
return true;
case R.id.menu_theme_mode:
selectMapTheme();
return true;
case R.id.menu_as_list:
{
CacheListActivity.startActivityMap(activity,new SearchResult(getGeocodesForCachesInViewport()));
return true;
}
case R.id.menu_strategy_fastest:
{
item.setChecked(true);
Settings.setLiveMapStrategy(Strategy.FASTEST);
return true;
}
case R.id.menu_strategy_fast:
{
item.setChecked(true);
Settings.setLiveMapStrategy(Strategy.FAST);
return true;
}
case R.id.menu_strategy_auto:
{
item.setChecked(true);
Settings.setLiveMapStrategy(Strategy.AUTO);
return true;
}
case R.id.menu_strategy_detailed:
{
item.setChecked(true);
Settings.setLiveMapStrategy(Strategy.DETAILED);
return true;
}
case R.id.menu_hint:
if (caches.size() == 1) {
caches.iterator().next().showHintToast(getActivity());
}
return true;
case R.id.menu_compass:
if (caches.size() == 1) {
CompassActivity.startActivityCache(this.getActivity(),caches.iterator().next());
}
return true;
default :
final MapSource mapSource=MapProviderFactory.getMapSource(id);
if (mapSource != null) {
item.setChecked(true);
changeMapSource(mapSource);
return true;
}
}
return false;
}
