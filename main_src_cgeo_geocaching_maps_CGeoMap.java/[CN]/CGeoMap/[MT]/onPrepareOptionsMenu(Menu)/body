{
  super.onPrepareOptionsMenu(menu);
  for (  MapSource mapSource : MapProviderFactory.getMapSources()) {
    final MenuItem menuItem=menu.findItem(mapSource.getNumericalId());
    if (menuItem != null) {
      menuItem.setEnabled(mapSource.isAvailable());
    }
  }
  try {
    MenuItem item=menu.findItem(R.id.menu_trail_mode);
    if (Settings.isMapTrail()) {
      item.setTitle(res.getString(R.string.map_trail_hide));
    }
 else {
      item.setTitle(res.getString(R.string.map_trail_show));
    }
    item=menu.findItem(R.id.menu_map_live);
    if (isLiveEnabled) {
      item.setTitle(res.getString(R.string.map_live_disable));
    }
 else {
      item.setTitle(res.getString(R.string.map_live_enable));
    }
    final Set<String> geocodesInViewport=getGeocodesForCachesInViewport();
    menu.findItem(R.id.menu_store_caches).setEnabled(!isLoading() && CollectionUtils.isNotEmpty(geocodesInViewport) && new SearchResult(geocodesInViewport).hasUnsavedCaches());
    item=menu.findItem(R.id.menu_circle_mode);
    if (overlayCaches != null && overlayCaches.getCircles()) {
      item.setTitle(res.getString(R.string.map_circles_hide));
    }
 else {
      item.setTitle(res.getString(R.string.map_circles_show));
    }
    item=menu.findItem(R.id.menu_theme_mode);
    item.setVisible(mapView.hasMapThemes());
    menu.findItem(R.id.menu_as_list).setEnabled(isLiveEnabled && !isLoading());
    menu.findItem(R.id.submenu_strategy).setEnabled(isLiveEnabled);
    Strategy strategy=Settings.getLiveMapStrategy();
    menu.findItem(R.id.menu_strategy_fastest).setChecked(strategy == Strategy.FASTEST);
    menu.findItem(R.id.menu_strategy_fast).setChecked(strategy == Strategy.FAST);
    menu.findItem(R.id.menu_strategy_auto).setChecked(strategy == Strategy.AUTO);
    menu.findItem(R.id.menu_strategy_detailed).setChecked(strategy == Strategy.DETAILED);
  }
 catch (  Exception e) {
    Log.e("cgeomap.onPrepareOptionsMenu",e);
  }
  return true;
}
