{
  final int what=msg.what;
  final CGeoMap map=mapRef.get();
  if (map == null) {
    return;
  }
switch (what) {
case UPDATE_TITLE:
    final StringBuilder title=new StringBuilder();
  if (map.mapMode == MapMode.LIVE && map.isLiveEnabled) {
    title.append(map.res.getString(R.string.map_live));
  }
 else {
    title.append(map.mapTitle);
  }
map.countVisibleCaches();
if (!map.caches.isEmpty() && !map.mapTitle.contains("[")) {
title.append(" [").append(map.cachesCnt);
if (map.cachesCnt != map.caches.size() && Settings.isDebug()) {
  title.append('/').append(map.caches.size());
}
title.append(']');
}
if (Settings.isDebug() && map.lastSearchResult != null && StringUtils.isNotBlank(map.lastSearchResult.getUrl())) {
title.append('[').append(map.lastSearchResult.getUrl()).append(']');
}
map.setTitle(title.toString());
break;
case INVALIDATE_MAP:
map.mapView.repaintRequired(null);
break;
default :
break;
}
}
