{
  try {
    stop=false;
    working=true;
    if (stop) {
      displayHandler.sendEmptyMessage(0);
      working=false;
      return;
    }
    double lat1=(centerLat / 1e6) - ((spanLat / 1e6) / 2) - ((spanLat / 1e6) / 4);
    double lat2=(centerLat / 1e6) + ((spanLat / 1e6) / 2) + ((spanLat / 1e6) / 4);
    double lon1=(centerLon / 1e6) - ((spanLon / 1e6) / 2) - ((spanLon / 1e6) / 4);
    double lon2=(centerLon / 1e6) + ((spanLon / 1e6) / 2) + ((spanLon / 1e6) / 4);
    double latMin=Math.min(lat1,lat2);
    double latMax=Math.max(lat1,lat2);
    double lonMin=Math.min(lon1,lon2);
    double lonMax=Math.max(lon1,lon2);
    if (token == null) {
      token=cgBase.getMapUserToken(noMapTokenHandler);
    }
    if (stop) {
      displayHandler.sendEmptyMessage(0);
      working=false;
      return;
    }
    search=base.searchByViewport(token,latMin,latMax,lonMin,lonMax,0);
    if (search != null) {
      downloaded=true;
    }
    if (stop) {
      displayHandler.sendEmptyMessage(0);
      working=false;
      return;
    }
    caches=app.getCaches(search,centerLat,centerLon,spanLat,spanLon);
    if (stop) {
      displayHandler.sendEmptyMessage(0);
      working=false;
      return;
    }
    if (loadTimer != null) {
      if (loadTimer.getDisplayThread() != null && loadTimer.getDisplayThread().isWorking()) {
        loadTimer.getDisplayThread().stopIt();
      }
      loadTimer.setDisplayThread(new DisplayThread(centerLat,centerLon,spanLat,spanLon));
      loadTimer.getDisplayThread().start();
    }
  }
  finally {
    working=false;
  }
}
