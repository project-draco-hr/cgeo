{
  final long currentTimeMillis=System.currentTimeMillis();
  if (currentTimeMillis > timeLastPositionOverlayCalculation + MIN_UPDATE_INTERVAL) {
    timeLastPositionOverlayCalculation=currentTimeMillis;
    try {
      if (mapView != null) {
        if (overlayPositionAndScale == null) {
          overlayPositionAndScale=mapView.createAddPositionAndScaleOverlay(activity);
        }
        boolean needsRepaintForDistance=needsRepaintForDistance();
        boolean needsRepaintForHeading=needsRepaintForHeading();
        if (needsRepaintForDistance) {
          if (followMyLocation) {
            centerMap(new Geopoint(currentLocation));
          }
        }
        if (needsRepaintForDistance || needsRepaintForHeading) {
          overlayPositionAndScale.setCoordinates(currentLocation);
          overlayPositionAndScale.setHeading(currentHeading);
          mapView.repaintRequired(overlayPositionAndScale);
        }
      }
    }
 catch (    RuntimeException e) {
      Log.w("Failed to update location.");
    }
  }
}
