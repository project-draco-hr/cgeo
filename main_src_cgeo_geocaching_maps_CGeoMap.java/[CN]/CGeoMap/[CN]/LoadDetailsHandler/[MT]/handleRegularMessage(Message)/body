{
  if (msg.what == UPDATE_PROGRESS) {
    if (waitDialog != null) {
      int secondsElapsed=(int)((System.currentTimeMillis() - detailProgressTime) / 1000);
      int secondsRemaining;
      if (detailProgress > 0) {
        secondsRemaining=(detailTotal - detailProgress) * secondsElapsed / detailProgress;
      }
 else {
        secondsRemaining=(detailTotal - detailProgress) * secondsElapsed;
      }
      waitDialog.setProgress(detailProgress);
      if (secondsRemaining < 40) {
        waitDialog.setMessage(res.getString(R.string.caches_downloading) + " " + res.getString(R.string.caches_eta_ltm));
      }
 else       if (secondsRemaining < 90) {
        waitDialog.setMessage(res.getString(R.string.caches_downloading) + " " + String.format("%d",(secondsRemaining / 60))+ " "+ res.getString(R.string.caches_eta_min));
      }
 else {
        waitDialog.setMessage(res.getString(R.string.caches_downloading) + " " + String.format("%d",(secondsRemaining / 60))+ " "+ res.getString(R.string.caches_eta_mins));
      }
    }
  }
 else   if (msg.what == FINISHED_LOADING_DETAILS) {
    if (waitDialog != null) {
      waitDialog.dismiss();
      waitDialog.setOnCancelListener(null);
    }
    if (geo == null) {
      geo=app.startGeo(activity,geoUpdate,0,0);
    }
    if (Settings.isUseCompass() && dir == null) {
      dir=app.startDir(activity,dirUpdate);
    }
  }
}
