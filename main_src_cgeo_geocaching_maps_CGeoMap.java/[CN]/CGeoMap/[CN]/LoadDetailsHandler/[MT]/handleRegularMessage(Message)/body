{
  if (msg.what == UPDATE_PROGRESS) {
    if (waitDialog != null) {
      final int secondsElapsed=(int)((System.currentTimeMillis() - detailProgressTime) / 1000);
      int secondsRemaining;
      if (detailProgress > 0) {
        secondsRemaining=(detailTotal - detailProgress) * secondsElapsed / detailProgress;
      }
 else {
        secondsRemaining=(detailTotal - detailProgress) * secondsElapsed;
      }
      waitDialog.setProgress(detailProgress);
      if (secondsRemaining < 40) {
        waitDialog.setMessage(res.getString(R.string.caches_downloading) + " " + res.getString(R.string.caches_eta_ltm));
      }
 else {
        final int minsRemaining=secondsRemaining / 60;
        waitDialog.setMessage(res.getString(R.string.caches_downloading) + " " + res.getQuantityString(R.plurals.caches_eta_mins,minsRemaining,minsRemaining));
      }
    }
  }
 else   if (msg.what == FINISHED_LOADING_DETAILS) {
    if (waitDialog != null) {
      waitDialog.dismiss();
      waitDialog.setOnCancelListener(null);
    }
  }
}
