{
  recordMapStoreFlags();
  try {
    setMapStoreFlags(false,false);
    Geocache cache=new Geocache();
    final String geocode="Test" + System.nanoTime();
    cache.setGeocode(geocode);
    cache.setWaypoints(new ArrayList<Waypoint>(),false);
    for (int i=0; i < 2; i++) {
      cache.setPersonalNote(note);
      cache.parseWaypointsFromNote();
      final List<Waypoint> waypoints=cache.getWaypoints();
      assertNotNull(waypoints);
      assertEquals(expectedWaypoints,waypoints.size());
      final Waypoint waypoint=waypoints.get(0);
      assertEquals(new Geopoint("N51 13.888 E007 03.444"),waypoint.getCoords());
      assertEquals(CgeoApplication.getInstance().getString(R.string.cache_personal_note) + " 1",waypoint.getName());
      cache.store(StoredList.TEMPORARY_LIST_ID,null);
    }
    removeCacheCompletely(geocode);
  }
  finally {
    restoreMapStoreFlags();
  }
}
