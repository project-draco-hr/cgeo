{
  final DefaultHttpClient client=new DefaultHttpClient();
  client.setCookieStore(Cookies.cookieStore);
  client.setParams(clientParams);
  client.setRedirectStrategy(new DefaultRedirectStrategy(){
    @Override public boolean isRedirected(    HttpRequest request,    HttpResponse response,    HttpContext context){
      boolean isRedirect=false;
      try {
        isRedirect=super.isRedirected(request,response,context);
      }
 catch (      final ProtocolException e) {
        Log.e("httpclient.isRedirected: unable to check for redirection",e);
      }
      if (!isRedirect) {
        final int responseCode=response.getStatusLine().getStatusCode();
        if (responseCode == 301 || responseCode == 302) {
          return true;
        }
      }
      return isRedirect;
    }
  }
);
  client.addRequestInterceptor(new HttpRequestInterceptor(){
    @Override public void process(    final HttpRequest request,    final HttpContext context) throws HttpException, IOException {
      if (!request.containsHeader("Accept-Encoding")) {
        request.addHeader("Accept-Encoding","gzip");
      }
    }
  }
);
  client.addResponseInterceptor(new HttpResponseInterceptor(){
    @Override public void process(    final HttpResponse response,    final HttpContext context) throws HttpException, IOException {
      final HttpEntity entity=response.getEntity();
      if (entity != null) {
        final Header contentEncoding=entity.getContentEncoding();
        if (contentEncoding != null) {
          for (          final HeaderElement codec : contentEncoding.getElements()) {
            if (codec.getName().equalsIgnoreCase("gzip")) {
              Log.d("Decompressing response");
              response.setEntity(new GzipDecompressingEntity(response.getEntity()));
              return;
            }
          }
        }
      }
    }
  }
);
  return client;
}
