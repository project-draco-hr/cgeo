{
  if (lhs == rhs) {
    return 0;
  }
  if (lhs == null || rhs == null) {
    throw new NullPointerException();
  }
  Class<?> lhsClazz=lhs.getClass();
  if (!lhsClazz.isInstance(rhs)) {
    throw new ClassCastException();
  }
  CompareToBuilder compareToBuilder=new CompareToBuilder();
  reflectionAppend(lhs,rhs,lhsClazz,compareToBuilder,compareTransients,excludeFields);
  while (lhsClazz.getSuperclass() != null && lhsClazz != reflectUpToClass) {
    lhsClazz=lhsClazz.getSuperclass();
    reflectionAppend(lhs,rhs,lhsClazz,compareToBuilder,compareTransients,excludeFields);
  }
  return compareToBuilder.toComparison();
}
