{
  if (inflater == null) {
    inflater=((Activity)getContext()).getLayoutInflater();
  }
  if (position > getCount()) {
    Log.w(cgSettings.tag,"cgCacheListAdapter.getView: Attempt to access missing item #" + position);
    return null;
  }
  cgCache cache=getItem(position);
  if (rowView == null) {
    rowView=(View)inflater.inflate(R.layout.cache,null);
    holder=new cgCacheView();
    holder.oneCache=(RelativeLayout)rowView.findViewById(R.id.one_cache);
    holder.checkbox=(CheckBox)rowView.findViewById(R.id.checkbox);
    holder.oneInfo=(RelativeLayout)rowView.findViewById(R.id.one_info);
    holder.oneCheckbox=(RelativeLayout)rowView.findViewById(R.id.one_checkbox);
    holder.foundMark=(ImageView)rowView.findViewById(R.id.found_mark);
    holder.offlineMark=(ImageView)rowView.findViewById(R.id.offline_mark);
    holder.oneCache=(RelativeLayout)rowView.findViewById(R.id.one_cache);
    holder.text=(TextView)rowView.findViewById(R.id.text);
    holder.directionLayout=(RelativeLayout)rowView.findViewById(R.id.direction_layout);
    holder.distance=(cgDistanceView)rowView.findViewById(R.id.distance);
    holder.direction=(cgCompassMini)rowView.findViewById(R.id.direction);
    holder.dirImgLayout=(RelativeLayout)rowView.findViewById(R.id.dirimg_layout);
    holder.dirImg=(ImageView)rowView.findViewById(R.id.dirimg);
    holder.inventory=(RelativeLayout)rowView.findViewById(R.id.inventory);
    holder.favourite=(TextView)rowView.findViewById(R.id.favourite);
    holder.info=(TextView)rowView.findViewById(R.id.info);
    rowView.setTag(holder);
  }
 else {
    holder=(cgCacheView)rowView.getTag();
  }
  if (cache.own == true) {
    if (settings.skin == 1) {
      holder.oneInfo.setBackgroundResource(R.color.owncache_background_light);
      holder.oneCheckbox.setBackgroundResource(R.color.owncache_background_light);
    }
 else {
      holder.oneInfo.setBackgroundResource(R.color.owncache_background_dark);
      holder.oneCheckbox.setBackgroundResource(R.color.owncache_background_dark);
    }
  }
 else {
    if (settings.skin == 1) {
      holder.oneInfo.setBackgroundResource(R.color.background_light);
      holder.oneCheckbox.setBackgroundResource(R.color.background_light);
    }
 else {
      holder.oneInfo.setBackgroundResource(R.color.background_dark);
      holder.oneCheckbox.setBackgroundResource(R.color.background_dark);
    }
  }
  final touchListener touchLst=new touchListener(cache.geocode,cache.name,cache);
  rowView.setOnClickListener(touchLst);
  rowView.setOnLongClickListener(touchLst);
  rowView.setOnTouchListener(touchLst);
  rowView.setLongClickable(true);
  if (selectMode == true) {
    if (cache.statusCheckedView == true) {
      moveRight(holder,cache,true);
    }
 else {
      moveRight(holder,cache,false);
    }
  }
 else   if (cache.statusChecked == true) {
    holder.checkbox.setChecked(true);
    if (cache.statusCheckedView == true) {
      moveRight(holder,cache,true);
    }
 else {
      moveRight(holder,cache,false);
    }
  }
 else {
    holder.checkbox.setChecked(false);
    if (cache.statusCheckedView == false) {
      holder.oneInfo.clearAnimation();
    }
 else {
      moveLeft(holder,cache,false);
    }
  }
  holder.checkbox.setOnClickListener(new checkBoxListener(cache));
  if (distances.contains(holder.distance) == false) {
    distances.add(holder.distance);
  }
  holder.distance.setContent(base,cache.latitude,cache.longitude);
  if (compasses.contains(holder.direction) == false) {
    compasses.add(holder.direction);
  }
  holder.direction.setContent(cache.latitude,cache.longitude);
  if (cache.logOffline == true) {
    holder.offlineMark.setVisibility(View.VISIBLE);
    holder.foundMark.setVisibility(View.GONE);
  }
 else   if (cache.found == true) {
    holder.offlineMark.setVisibility(View.GONE);
    holder.foundMark.setVisibility(View.VISIBLE);
  }
 else {
    holder.offlineMark.setVisibility(View.GONE);
    holder.foundMark.setVisibility(View.GONE);
  }
  if (cache.nameSp == null) {
    cache.nameSp=(new Spannable.Factory()).newSpannable(cache.name);
    if (cache.disabled == true || cache.archived == true) {
      cache.nameSp.setSpan(new StrikethroughSpan(),0,cache.nameSp.toString().length(),Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
    }
  }
  holder.text.setText(cache.nameSp,TextView.BufferType.SPANNABLE);
  if (gcIcons.containsKey(cache.type) == true) {
    holder.text.setCompoundDrawablesWithIntrinsicBounds(gcIcons.get(cache.type),null,null,null);
  }
 else {
    holder.text.setCompoundDrawablesWithIntrinsicBounds(gcIcons.get("mystery"),null,null,null);
  }
  if (holder.inventory.getChildCount() > 0) {
    holder.inventory.removeAllViews();
  }
  ImageView tbIcon=null;
  if (cache.inventoryItems > 0) {
    tbIcon=(ImageView)inflater.inflate(R.layout.trackable_icon,null);
    tbIcon.setImageResource(R.drawable.trackable_all);
    holder.inventory.addView(tbIcon);
    holder.inventory.setVisibility(View.VISIBLE);
  }
 else {
    holder.inventory.setVisibility(View.GONE);
  }
  boolean setDiDi=false;
  if (cache.latitude != null && cache.longitude != null) {
    holder.direction.setVisibility(View.VISIBLE);
    holder.direction.updateAzimuth(azimuth);
    if (latitude != null && longitude != null) {
      holder.distance.update(latitude,longitude);
      holder.direction.updateCoords(latitude,longitude);
    }
    setDiDi=true;
  }
 else {
    if (cache.distance != null) {
      holder.distance.setDistance(cache.distance);
      setDiDi=true;
    }
    if (cache.direction != null) {
      holder.direction.setVisibility(View.VISIBLE);
      holder.direction.updateAzimuth(azimuth);
      holder.direction.updateHeading(cache.direction);
      setDiDi=true;
    }
  }
  if (setDiDi == true) {
    holder.directionLayout.setVisibility(View.VISIBLE);
    holder.dirImgLayout.setVisibility(View.GONE);
  }
 else {
    holder.directionLayout.setVisibility(View.GONE);
    holder.distance.clear();
    Bitmap dirImgPre=null;
    Bitmap dirImg=null;
    try {
      dirImgPre=BitmapFactory.decodeFile(settings.getStorage() + cache.geocode + "/direction.png");
      dirImg=dirImgPre.copy(Bitmap.Config.ARGB_8888,true);
      dirImgPre.recycle();
      dirImgPre=null;
    }
 catch (    Exception e) {
    }
    if (dirImg != null) {
      if (settings.skin == 0) {
        int length=dirImg.getWidth() * dirImg.getHeight();
        int[] pixels=new int[length];
        dirImg.getPixels(pixels,0,dirImg.getWidth(),0,0,dirImg.getWidth(),dirImg.getHeight());
        for (int i=0; i < length; i++) {
          if (pixels[i] == 0xff000000) {
            pixels[i]=0xffffffff;
          }
        }
        dirImg.setPixels(pixels,0,dirImg.getWidth(),0,0,dirImg.getWidth(),dirImg.getHeight());
      }
      holder.dirImg.setImageBitmap(dirImg);
      holder.dirImgLayout.setVisibility(View.VISIBLE);
    }
 else {
      holder.dirImg.setImageBitmap(null);
      holder.dirImgLayout.setVisibility(View.GONE);
    }
  }
  if (cache.favouriteCnt != null) {
    holder.favourite.setText(String.format("%d",cache.favouriteCnt));
  }
 else {
    holder.favourite.setText("---");
  }
  int favoriteBack;
  if (settings.skin == 1) {
    favoriteBack=R.drawable.favourite_background_light;
  }
 else {
    favoriteBack=R.drawable.favourite_background_dark;
  }
  if (cache.myVote != null && cache.myVote > 0) {
    if (cache.myVote >= 4) {
      favoriteBack=ratingBcgs[2];
    }
 else     if (cache.myVote >= 3) {
      favoriteBack=ratingBcgs[1];
    }
 else     if (cache.myVote > 0) {
      favoriteBack=ratingBcgs[0];
    }
  }
 else   if (cache.rating != null && cache.rating > 0) {
    if (cache.rating >= 3.5) {
      favoriteBack=ratingBcgs[2];
    }
 else     if (cache.rating >= 2.1) {
      favoriteBack=ratingBcgs[1];
    }
 else     if (cache.rating > 0.0) {
      favoriteBack=ratingBcgs[0];
    }
  }
  holder.favourite.setBackgroundResource(favoriteBack);
  StringBuilder cacheInfo=new StringBuilder();
  if (historic == true && cache.visitedDate != null) {
    cacheInfo.append(cgBase.timeOut.format(cache.visitedDate));
    cacheInfo.append("; ");
    cacheInfo.append(cgBase.dateOut.format(cache.visitedDate));
  }
 else {
    if (cache.geocode != null && cache.geocode.length() > 0) {
      cacheInfo.append(cache.geocode);
    }
    if (cache.size != null && cache.size.length() > 0) {
      if (cacheInfo.length() > 0) {
        cacheInfo.append(" | ");
      }
      cacheInfo.append(cache.size);
    }
    if ((cache.difficulty != null && cache.difficulty > 0f) || (cache.terrain != null && cache.terrain > 0f) || (cache.rating != null && cache.rating > 0f)) {
      if (cacheInfo.length() > 0 && ((cache.difficulty != null && cache.difficulty > 0f) || (cache.terrain != null && cache.terrain > 0f))) {
        cacheInfo.append(" |");
      }
      if (cache.difficulty != null && cache.difficulty > 0f) {
        cacheInfo.append(" D:");
        cacheInfo.append(String.format(Locale.getDefault(),"%.1f",cache.difficulty));
      }
      if (cache.terrain != null && cache.terrain > 0f) {
        cacheInfo.append(" T:");
        cacheInfo.append(String.format(Locale.getDefault(),"%.1f",cache.terrain));
      }
    }
    if (cache.members == true) {
      if (cacheInfo.length() > 0) {
        cacheInfo.append(" | ");
      }
      cacheInfo.append(res.getString(R.string.cache_premium));
    }
    if (cache.reason != null && cache.reason == 1) {
      if (cacheInfo.length() > 0) {
        cacheInfo.append(" | ");
      }
      cacheInfo.append(res.getString(R.string.cache_offline));
    }
  }
  holder.info.setText(cacheInfo.toString());
  return rowView;
}
