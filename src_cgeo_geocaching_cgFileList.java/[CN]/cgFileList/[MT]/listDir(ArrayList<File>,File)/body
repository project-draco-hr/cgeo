{
  if (directory == null || directory.isDirectory() == false || directory.canRead() == false) {
    return;
  }
  final File[] listPre=directory.listFiles();
  String fileExt=getFileExtension();
  if (listPre != null && listPre.length > 0) {
    for (    File file : listPre) {
      if (endSearching) {
        return;
      }
      if (file.canRead() && file.isFile()) {
        final String[] nameParts=file.getName().split("\\.");
        if (nameParts.length > 1) {
          final String extension=nameParts[(nameParts.length - 1)].toLowerCase();
          if (extension.equals(fileExt) == false) {
            continue;
          }
        }
 else {
          continue;
        }
        list.add(file);
      }
 else       if (file.canRead() && file.isDirectory()) {
        final Message msg=new Message();
        String name=file.getName();
        if (name.substring(0,1).equals(".")) {
          continue;
        }
        if (name.length() > 16) {
          name=name.substring(0,14) + "...";
        }
        msg.obj=name;
        changeWaitDialogHandler.sendMessage(msg);
        listDir(list,file);
      }
    }
  }
  return;
}
