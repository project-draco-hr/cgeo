{
  final String geocode="OCDDD2";
  removeCacheCompletely(geocode);
  final File ocddd2=new File(tempDir,"ocddd2.gpx");
  copyResourceToFile(R.raw.ocddd2,ocddd2);
  final GPXImporter.ImportGpxFileThread importThread=new GPXImporter.ImportGpxFileThread(ocddd2,listId,importStepHandler,progressHandler);
  runImportThread(importThread);
  assertThat(importStepHandler.messages).hasSize(4);
  final Iterator<Message> iMsg=importStepHandler.messages.iterator();
  assertThat(iMsg.next().what).isEqualTo(GPXImporter.IMPORT_STEP_START);
  assertThat(iMsg.next().what).isEqualTo(GPXImporter.IMPORT_STEP_READ_FILE);
  assertThat(iMsg.next().what).isEqualTo(GPXImporter.IMPORT_STEP_STORE_STATIC_MAPS);
  assertThat(iMsg.next().what).isEqualTo(GPXImporter.IMPORT_STEP_FINISHED);
  final SearchResult search=(SearchResult)importStepHandler.messages.get(3).obj;
  assertThat(new ArrayList<String>(search.getGeocodes())).isEqualTo(Collections.singletonList(geocode));
  final Geocache cache=DataStore.loadCache(geocode,LoadFlags.LOAD_CACHE_OR_DB);
  assertCacheProperties(cache);
  assertThat(cache.getWaypoints()).as("Number of imported waypoints").hasSize(4);
}
