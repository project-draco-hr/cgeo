{
  final long startTime=System.currentTimeMillis();
  final String deviceCode=StringUtils.defaultString(Settings.getWebDeviceCode());
  final Parameters params=new Parameters("code",deviceCode);
  while (!handler.isCancelled() && System.currentTimeMillis() - startTime < 3 * 60000) {
    final HttpResponse responseFromWeb=Network.getRequest("http://send2.cgeo.org/read.html",params);
    if (responseFromWeb != null && responseFromWeb.getStatusLine().getStatusCode() == 200) {
      final String response=Network.getResponseData(responseFromWeb);
      if (response != null && response.length() > 2) {
        handler.sendMessage(handler.obtainMessage(MSG_LOADING,response));
        Geocache.storeCache(null,response,listIdLFW,false,null);
        handler.sendMessage(handler.obtainMessage(MSG_LOADED,response));
      }
 else       if ("RG".equals(response)) {
        Settings.setWebNameCode(null,null);
        handler.sendEmptyMessage(MSG_NO_REGISTRATION);
        handler.cancel();
        break;
      }
 else {
        try {
          sleep(5000);
        }
 catch (        final InterruptedException e) {
        }
        handler.sendEmptyMessage(MSG_WAITING);
      }
    }
 else {
      handler.sendEmptyMessage(MSG_SERVER_FAIL);
      handler.cancel();
      break;
    }
  }
  handler.sendEmptyMessage(MSG_DONE);
}
