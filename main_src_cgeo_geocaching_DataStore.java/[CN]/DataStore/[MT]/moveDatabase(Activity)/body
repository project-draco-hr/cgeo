{
  final ProgressDialog dialog=ProgressDialog.show(fromActivity,fromActivity.getString(R.string.init_dbmove_dbmove),fromActivity.getString(R.string.init_dbmove_running),true,false);
  RxUtils.subscribeOnIOThenUI(Async.fromCallable(new Func0<Boolean>(){
    @Override public Boolean call(){
      if (!LocalStorage.isExternalStorageAvailable()) {
        Log.w("Database was not moved: external memory not available");
        return false;
      }
      closeDb();
      final File source=databasePath();
      final File target=databaseAlternatePath();
      if (!LocalStorage.copy(source,target)) {
        Log.e("Database could not be moved to " + target);
        init();
        return false;
      }
      if (!FileUtils.delete(source)) {
        Log.e("Original database could not be deleted during move");
      }
      Settings.setDbOnSDCard(!Settings.isDbOnSDCard());
      Log.i("Database was moved to " + target);
      init();
      return true;
    }
  }
),new Action1<Boolean>(){
    @Override public void call(    final Boolean success){
      dialog.dismiss();
      final String message=success ? fromActivity.getString(R.string.init_dbmove_success) : fromActivity.getString(R.string.init_dbmove_failed);
      Dialogs.message(fromActivity,R.string.init_dbmove_dbmove,message);
    }
  }
);
}
