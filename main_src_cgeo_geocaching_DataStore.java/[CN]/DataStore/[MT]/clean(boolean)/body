{
  if (databaseCleaned) {
    return;
  }
  Log.d("Database clean: started");
  try {
    Set<String> geocodes=new HashSet<String>();
    if (more) {
      queryToColl(dbTableCaches,new String[]{"geocode"},"reason = 0",null,null,null,null,null,geocodes,GET_STRING_0);
    }
 else {
      final long timestamp=System.currentTimeMillis() - DAYS_AFTER_CACHE_IS_DELETED;
      final String timestampString=Long.toString(timestamp);
      queryToColl(dbTableCaches,new String[]{"geocode"},"reason = 0 and detailed < ? and detailedupdate < ? and visiteddate < ?",new String[]{timestampString,timestampString,timestampString},null,null,null,null,geocodes,GET_STRING_0);
    }
    geocodes=exceptCachesWithOfflineLog(geocodes);
    if (!geocodes.isEmpty()) {
      Log.d("Database clean: removing " + geocodes.size() + " geocaches from listId=0");
      removeCaches(geocodes,LoadFlags.REMOVE_ALL);
    }
    Log.d("Database clean: removing obsolete log images records");
    database.delete(dbTableLogImages,"log_id NOT IN (SELECT _id FROM " + dbTableLogs + ")",null);
  }
 catch (  final Exception e) {
    Log.w("DataStore.clean",e);
  }
  Log.d("Database clean: finished");
  databaseCleaned=true;
}
