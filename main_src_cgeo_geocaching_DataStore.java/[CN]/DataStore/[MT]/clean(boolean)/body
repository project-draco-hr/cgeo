{
  if (databaseCleaned) {
    return;
  }
  init();
  Log.d("Database clean: started");
  try {
    Cursor cursor;
    if (more) {
      cursor=database.query(dbTableCaches,new String[]{"geocode"},"reason = 0",null,null,null,null,null);
    }
 else {
      long timestamp=System.currentTimeMillis() - DAYS_AFTER_CACHE_IS_DELETED;
      String timestampString=Long.toString(timestamp);
      cursor=database.query(dbTableCaches,new String[]{"geocode"},"reason = 0 and detailed < ? and detailedupdate < ? and visiteddate < ?",new String[]{timestampString,timestampString,timestampString},null,null,null,null);
    }
    Set<String> geocodes=new HashSet<String>();
    while (cursor.moveToNext()) {
      geocodes.add(cursor.getString(0));
    }
    cursor.close();
    geocodes=exceptCachesWithOfflineLog(geocodes);
    if (!geocodes.isEmpty()) {
      Log.d("Database clean: removing " + geocodes.size() + " geocaches from listId=0");
      removeCaches(geocodes,LoadFlags.REMOVE_ALL);
    }
  }
 catch (  final Exception e) {
    Log.w("DataStore.clean",e);
  }
  Log.d("Database clean: finished");
  databaseCleaned=true;
}
