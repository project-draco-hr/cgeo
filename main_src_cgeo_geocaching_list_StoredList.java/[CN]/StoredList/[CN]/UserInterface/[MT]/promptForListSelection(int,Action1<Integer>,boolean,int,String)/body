{
  final List<AbstractList> lists=new ArrayList<AbstractList>();
  lists.addAll(getSortedLists());
  if (exceptListId > StoredList.TEMPORARY_LIST_ID) {
    StoredList exceptList=DataStore.getList(exceptListId);
    if (exceptList != null) {
      lists.remove(exceptList);
    }
  }
  if (!onlyConcreteLists) {
    if (exceptListId != PseudoList.ALL_LIST.id) {
      lists.add(PseudoList.ALL_LIST);
    }
    if (exceptListId != PseudoList.HISTORY_LIST.id) {
      lists.add(PseudoList.HISTORY_LIST);
    }
  }
  lists.add(PseudoList.NEW_LIST);
  final List<CharSequence> listsTitle=new ArrayList<CharSequence>();
  for (  AbstractList list : lists) {
    listsTitle.add(list.getTitleAndCount());
  }
  final CharSequence[] items=new CharSequence[listsTitle.size()];
  final Activity activity=activityRef.get();
  AlertDialog.Builder builder=new AlertDialog.Builder(activity);
  builder.setTitle(res.getString(titleId));
  builder.setItems(listsTitle.toArray(items),new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialogInterface,    int itemId){
      final AbstractList list=lists.get(itemId);
      if (list == PseudoList.NEW_LIST) {
        promptForListCreation(runAfterwards,newListName);
      }
 else {
        runAfterwards.call(lists.get(itemId).id);
      }
    }
  }
);
  builder.create().show();
}
