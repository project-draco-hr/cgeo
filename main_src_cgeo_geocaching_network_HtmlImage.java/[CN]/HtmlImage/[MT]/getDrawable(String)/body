{
  if (StringUtils.isBlank(url) || isCounter(url)) {
    return getTransparent1x1Image(resources);
  }
  final boolean shared=url.contains("/images/icons/icon_");
  final String pseudoGeocode=shared ? SHARED : geocode;
  Bitmap image=loadImageFromStorage(url,pseudoGeocode,shared);
  if (image == null) {
    final File file=LocalStorage.getStorageFile(pseudoGeocode,url,true,true);
    if (url.startsWith("data:image/")) {
      if (url.contains(";base64,")) {
        saveBase64ToFile(url,file);
      }
 else {
        Log.e("HtmlImage.getDrawable: unable to decode non-base64 inline image");
        return null;
      }
    }
 else {
      downloadOrRefreshCopy(url,file);
    }
  }
  if (onlySave) {
    return null;
  }
  if (image == null) {
    image=loadImageFromStorage(url,pseudoGeocode,shared);
  }
  if (image == null) {
    Log.d("HtmlImage.getDrawable: Failed to obtain image");
    return returnErrorImage ? new BitmapDrawable(resources,BitmapFactory.decodeResource(resources,R.drawable.image_not_loaded)) : getTransparent1x1Image(resources);
  }
  return ImageUtils.scaleBitmapToFitDisplay(image);
}
