{
  super.onCreate(savedInstanceState);
  activity=this;
  res=this.getResources();
  app=(cgeoapplication)this.getApplication();
  settings=new cgSettings(this,getSharedPreferences(cgSettings.preferences,0));
  base=new cgBase(app,settings,getSharedPreferences(cgSettings.preferences,0));
  warning=new cgWarning(this);
  if (settings.skin == 1) {
    setTheme(R.style.light);
  }
 else {
    setTheme(R.style.dark);
  }
  setContentView(R.layout.visit);
  base.setTitle(activity,res.getString(R.string.log_new_log));
  Bundle extras=getIntent().getExtras();
  if (extras != null) {
    cacheid=extras.getString("id");
    geocode=extras.getString("geocode");
    text=extras.getString("text");
    alreadyFound=extras.getBoolean("found");
  }
  if ((cacheid == null || cacheid.length() == 0) && geocode != null && geocode.length() > 0) {
    cacheid=app.getCacheid(geocode);
  }
  if ((geocode == null || geocode.length() == 0) && cacheid != null && cacheid.length() > 0) {
    geocode=app.getGeocode(cacheid);
  }
  cache=app.getCacheByGeocode(geocode);
  if (cache.name != null && cache.name.length() > 0) {
    base.setTitle(activity,res.getString(R.string.log_new_log) + " " + cache.name);
  }
 else {
    base.setTitle(activity,res.getString(R.string.log_new_log) + " " + cache.geocode.toUpperCase());
  }
  app.setAction(geocode);
  if (cache == null) {
    warning.showToast(res.getString(R.string.err_detail_cache_forgot_visit));
    finish();
    return;
  }
  init();
}
