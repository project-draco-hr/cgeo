{
  if (geocode != null) {
    app.setAction(geocode);
  }
  types=cache.getPossibleLogTypes(settings);
  final cgLog log=app.loadLogOffline(geocode);
  if (log != null) {
    typeSelected=log.type;
    date.setTime(new Date(log.date));
    text=log.log;
    if (typeSelected == cgBase.LOG_FOUND_IT && settings.isGCvoteLogin()) {
      if (post == null) {
        post=(Button)findViewById(R.id.post);
      }
      post.setText(res.getString(R.string.log_post_no_rate));
    }
  }
 else   if (settings.getSignature() != null && settings.signatureAutoinsert && settings.getSignature().length() > 0 && 0 == ((EditText)findViewById(R.id.log)).getText().length()) {
    insertIntoLog(LogTemplateProvider.applyTemplates(settings.getSignature(),base));
  }
  if (types.contains(typeSelected) == false) {
    if (alreadyFound) {
      typeSelected=cgBase.LOG_NOTE;
    }
 else {
      typeSelected=types.get(0);
    }
    setType(typeSelected);
  }
  Button typeButton=(Button)findViewById(R.id.type);
  registerForContextMenu(typeButton);
  typeButton.setText(cgBase.logTypes2.get(typeSelected));
  typeButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View view){
      openContextMenu(view);
    }
  }
);
  Button dateButton=(Button)findViewById(R.id.date);
  dateButton.setText(base.formatShortDate(date.getTime().getTime()));
  dateButton.setOnClickListener(new cgeovisitDateListener());
  EditText logView=(EditText)findViewById(R.id.log);
  if (logView.getText().length() == 0 && text != null && text.length() > 0) {
    logView.setText(text);
  }
  if (tweetBox == null) {
    tweetBox=(LinearLayout)findViewById(R.id.tweet_box);
  }
  if (tweetCheck == null) {
    tweetCheck=(CheckBox)findViewById(R.id.tweet);
  }
  tweetCheck.setChecked(true);
  if (post == null) {
    post=(Button)findViewById(R.id.post);
  }
  if (cgBase.isEmpty(viewstates)) {
    post.setEnabled(false);
    post.setOnTouchListener(null);
    post.setOnClickListener(null);
    loadData thread;
    thread=new loadData(cacheid);
    thread.start();
  }
 else {
    post.setEnabled(true);
    post.setOnClickListener(new postListener());
  }
  if (save == null) {
    save=(Button)findViewById(R.id.save);
  }
  save.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      String log=((EditText)findViewById(R.id.log)).getText().toString();
      cache.logOffline(cgeovisit.this,log,date,typeSelected);
    }
  }
);
  if (clear == null) {
    clear=(Button)findViewById(R.id.clear);
  }
  clear.setOnClickListener(new clearListener());
}
