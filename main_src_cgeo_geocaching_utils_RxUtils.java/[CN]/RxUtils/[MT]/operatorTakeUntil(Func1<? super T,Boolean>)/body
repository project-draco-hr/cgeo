{
  return new Operator<T,T>(){
    @Override public Subscriber<? super T> call(    final Subscriber<? super T> subscriber){
      return new Subscriber<T>(subscriber){
        private boolean done=false;
        @Override public void onCompleted(){
          if (!done) {
            subscriber.onCompleted();
          }
        }
        @Override public void onError(        final Throwable e){
          if (!done) {
            subscriber.onError(e);
          }
        }
        @Override public void onNext(        final T t){
          subscriber.onNext(t);
          boolean shouldEnd=false;
          try {
            shouldEnd=predicate.call(t);
          }
 catch (          final Throwable e) {
            done=true;
            subscriber.onError(e);
            unsubscribe();
          }
          if (shouldEnd) {
            done=true;
            subscriber.onCompleted();
            unsubscribe();
          }
        }
      }
;
    }
  }
;
}
