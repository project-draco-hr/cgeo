{
  try {
    if (cache != null) {
      final HashMap<String,String> params=new HashMap<String,String>();
      params.put("geocode",cache.geocode);
      final Long searchId=searchByGeocode(params,listId,false);
      cache=app.getCache(searchId);
    }
 else     if (geocode != null) {
      final HashMap<String,String> params=new HashMap<String,String>();
      params.put("geocode",geocode);
      final Long searchId=searchByGeocode(params,listId,false);
      cache=app.getCache(searchId);
    }
    if (cache == null) {
      if (handler != null) {
        handler.sendMessage(new Message());
      }
      return;
    }
    final cgHtmlImg imgGetter=new cgHtmlImg(activity,cache.geocode,false,listId,true);
    if (cache.description != null) {
      Html.fromHtml(cache.description,imgGetter,null);
    }
    if (cache.spoilers != null && cache.spoilers.isEmpty() == false) {
      for (      cgImage oneSpoiler : cache.spoilers) {
        imgGetter.getDrawable(oneSpoiler.url);
      }
    }
    if (settings.storelogimages) {
      for (      cgLog log : cache.logs) {
        if (log.logImages != null && log.logImages.isEmpty() == false) {
          for (          cgImage oneLogImg : log.logImages) {
            imgGetter.getDrawable(oneLogImg.url);
          }
        }
      }
    }
    StaticMapsProvider.downloadMaps(cache,settings,activity);
    app.markStored(cache.geocode,listId);
    app.removeCacheFromCache(cache.geocode);
    if (handler != null) {
      handler.sendMessage(new Message());
    }
  }
 catch (  Exception e) {
    Log.e(cgSettings.tag,"cgBase.storeCache: " + e.toString());
  }
}
