{
  final Map<String,Waypoint> newPrefixes=new HashMap<String,Waypoint>(newPoints.size());
  for (  final Waypoint waypoint : newPoints) {
    newPrefixes.put(waypoint.getPrefix(),waypoint);
  }
  for (  final Waypoint oldWaypoint : oldPoints) {
    final String prefix=oldWaypoint.getPrefix();
    if (newPrefixes.containsKey(prefix)) {
      newPrefixes.get(prefix).merge(oldWaypoint);
    }
 else     if (oldWaypoint.isUserDefined() || forceMerge) {
      if (!isPersonalNoteWaypoint(oldWaypoint)) {
        newPoints.add(oldWaypoint);
      }
    }
  }
}
