{
  if (pattern == null) {
    throw new NullPointerException("pattern must not be null");
  }
  if (timeZone == null) {
    timeZone=TimeZone.getDefault();
  }
  if (locale == null) {
    locale=Locale.getDefault();
  }
  MultipartKey key=new MultipartKey(pattern,timeZone,locale);
  F format=cInstanceCache.get(key);
  if (format == null) {
    format=createInstance(pattern,timeZone,locale);
    F previousValue=cInstanceCache.putIfAbsent(key,format);
    if (previousValue != null) {
      format=previousValue;
    }
  }
  return format;
}
