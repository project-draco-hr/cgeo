{
  try {
    final Uri calendarProvider=Compatibility.getCalenderEventsProviderURI();
    final Date eventDate=new Date(Long.parseLong(hiddenDate));
    eventDate.setHours(0);
    eventDate.setMinutes(0);
    eventDate.setSeconds(0);
    final StringBuilder description=new StringBuilder();
    description.append(url);
    if (shortDesc.length() > 0) {
      final Spanned spanned=Html.fromHtml(shortDesc,null,null);
      String text=spanned.toString();
      final ImageSpan[] spans=spanned.getSpans(0,spanned.length(),ImageSpan.class);
      for (int i=spans.length - 1; i >= 0; i--) {
        text=text.substring(0,spanned.getSpanStart(spans[i])) + text.substring(spanned.getSpanEnd(spans[i]));
      }
      if (text.length() > 0) {
        description.append("\n\n");
        description.append(text);
      }
    }
    if (personalNote.length() > 0) {
      description.append("\n\n").append(Html.fromHtml(personalNote).toString());
    }
    final StringBuilder locBuffer=new StringBuilder();
    if (coords.length() > 0) {
      locBuffer.append(coords);
    }
    if (location.length() > 0) {
      boolean addParentheses=false;
      if (locBuffer.length() > 0) {
        addParentheses=true;
        locBuffer.append(" (");
      }
      locBuffer.append(Html.fromHtml(location).toString());
      if (addParentheses) {
        locBuffer.append(')');
      }
    }
    final ContentValues event=new ContentValues();
    event.put("calendar_id",calendarId);
    event.put("dtstart",eventDate.getTime() + 43200000);
    event.put("dtend",eventDate.getTime() + 43200000 + 3600000);
    event.put("eventTimezone","UTC");
    event.put("title",Html.fromHtml(name).toString());
    event.put("description",description.toString());
    if (locBuffer.length() > 0) {
      event.put("eventLocation",locBuffer.toString());
    }
    event.put("allDay",1);
    event.put("hasAlarm",0);
    getContentResolver().insert(calendarProvider,event);
    showToast(getResources().getString(R.string.event_success));
  }
 catch (  Exception e) {
    showToast(getResources().getString(R.string.event_fail));
    Log.e(LOG_TAG,"CalendarActivity.addToCalendarFn: " + e.toString());
  }
}
