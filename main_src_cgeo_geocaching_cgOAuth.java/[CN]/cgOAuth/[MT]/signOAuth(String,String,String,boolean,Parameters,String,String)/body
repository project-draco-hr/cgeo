{
  String paramsDone="";
  long currentTime=new Date().getTime();
  currentTime=currentTime / 1000;
  currentTime=(long)Math.floor(currentTime);
  params.put("oauth_consumer_key",Settings.getKeyConsumerPublic());
  params.put("oauth_nonce",CryptUtils.md5(Long.toString(System.currentTimeMillis())));
  params.put("oauth_signature_method","HMAC-SHA1");
  params.put("oauth_timestamp",Long.toString(currentTime));
  params.put("oauth_token",StringUtils.defaultString(token));
  params.put("oauth_version","1.0");
  params.sort();
  List<String> paramsEncoded=new ArrayList<String>();
  for (  final NameValuePair nameValue : params) {
    paramsEncoded.add(nameValue.getName() + "=" + cgBase.urlencode_rfc3986(nameValue.getValue()));
  }
  final String keysPacked=Settings.getKeyConsumerSecret() + "&" + StringUtils.defaultString(tokenSecret);
  final String requestPacked=method + "&" + cgBase.urlencode_rfc3986((https ? "https" : "http") + "://" + host+ path)+ "&"+ cgBase.urlencode_rfc3986(StringUtils.join(paramsEncoded.toArray(),'&'));
  paramsEncoded.add("oauth_signature=" + cgBase.urlencode_rfc3986(cgBase.base64Encode(CryptUtils.hashHmac(requestPacked,keysPacked))));
  paramsDone=StringUtils.join(paramsEncoded.toArray(),'&');
  return paramsDone;
}
