{
  if (loc == null) {
    gps=-1;
    return;
  }
  location=loc;
  String provider=location.getProvider();
  if (provider.equals(LocationManager.GPS_PROVIDER)) {
    gps=1;
  }
 else   if (provider.equals(LocationManager.NETWORK_PROVIDER)) {
    gps=0;
  }
 else   if (provider.equals("last")) {
    gps=-1;
  }
  coordsNow=new Geopoint(location.getLatitude(),location.getLongitude());
  app.setLastLoc(coordsNow);
  if (location.hasAltitude() && gps != -1) {
    altitudeNow=location.getAltitude() + settings.altCorrection;
  }
 else {
    altitudeNow=null;
  }
  if (location.hasBearing() && gps != -1) {
    bearingNow=Double.valueOf(location.getBearing());
  }
 else {
    bearingNow=Double.valueOf(0);
  }
  if (location.hasSpeed() && gps != -1) {
    speedNow=location.getSpeed();
  }
 else {
    speedNow=0f;
  }
  if (location.hasAccuracy() && gps != -1) {
    accuracyNow=location.getAccuracy();
  }
 else {
    accuracyNow=999f;
  }
  if (gps == 1) {
    if (coordsBefore != null && coordsNow != null) {
      final double dst=cgBase.getDistance(coordsBefore,coordsNow);
      if (Double.isNaN(dst) == false && dst > 0.005) {
        distanceNow+=dst;
        coordsBefore=coordsNow;
      }
    }
 else     if (coordsBefore == null) {
      coordsBefore=coordsNow;
    }
  }
  if (geoUpdate != null) {
    geoUpdate.updateLoc(this);
  }
  if (gps > -1) {
    (new publishLoc()).start();
  }
}
