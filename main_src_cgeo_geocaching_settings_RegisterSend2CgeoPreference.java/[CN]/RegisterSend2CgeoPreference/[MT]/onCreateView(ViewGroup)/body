{
  activity=(SettingsActivity)getContext();
  setOnPreferenceClickListener(new OnPreferenceClickListener(){
    @Override public boolean onPreferenceClick(    Preference preference){
      final String deviceName=Settings.getWebDeviceName();
      final String deviceCode=Settings.getWebDeviceCode();
      if (StringUtils.isBlank(deviceName)) {
        ActivityMixin.showToast(activity,R.string.err_missing_device_name);
        return false;
      }
      progressDialog=ProgressDialog.show(activity,activity.getString(R.string.init_sendToCgeo),activity.getString(R.string.init_sendToCgeo_registering),true);
      progressDialog.setCancelable(false);
      (new Thread(){
        @Override public void run(){
          int pin=0;
          final String nam=StringUtils.defaultString(deviceName);
          final String cod=StringUtils.defaultString(deviceCode);
          final Parameters params=new Parameters("name",nam,"code",cod);
          HttpResponse response=Network.getRequest("http://send2.cgeo.org/auth.html",params);
          if (response != null && response.getStatusLine().getStatusCode() == 200) {
            String[] strings=StringUtils.split(Network.getResponseData(response),',');
            try {
              pin=Integer.parseInt(strings[1].trim());
            }
 catch (            Exception e) {
              Log.e("webDialog",e);
            }
            String code=strings[0];
            Settings.setWebNameCode(nam,code);
          }
          webAuthHandler.sendEmptyMessage(pin);
        }
      }
).start();
      return true;
    }
  }
);
  return super.onCreateView(parent);
}
