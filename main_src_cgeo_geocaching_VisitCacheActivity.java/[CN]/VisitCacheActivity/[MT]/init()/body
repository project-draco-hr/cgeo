{
  if (geocode != null) {
    app.setAction(geocode);
  }
  postButton=(Button)findViewById(R.id.post);
  tweetBox=(LinearLayout)findViewById(R.id.tweet_box);
  tweetCheck=(CheckBox)findViewById(R.id.tweet);
  clearButton=(Button)findViewById(R.id.clear);
  saveButton=(Button)findViewById(R.id.save);
  possibleLogTypes=cache.getPossibleLogTypes();
  final cgLog log=app.loadLogOffline(geocode);
  if (log != null) {
    typeSelected=log.type;
    date.setTime(new Date(log.date));
    text=log.log;
    updatePostButtonText();
  }
 else   if (StringUtils.isNotBlank(Settings.getSignature()) && Settings.isAutoInsertSignature() && StringUtils.isBlank(((EditText)findViewById(R.id.log)).getText())) {
    insertIntoLog(LogTemplateProvider.applyTemplates(Settings.getSignature(),false),false);
  }
  if (!possibleLogTypes.contains(typeSelected)) {
    if (alreadyFound) {
      typeSelected=LogType.LOG_NOTE;
    }
 else {
      typeSelected=possibleLogTypes.get(0);
    }
    setType(typeSelected);
  }
  final Button typeButton=(Button)findViewById(R.id.type);
  registerForContextMenu(typeButton);
  typeButton.setText(typeSelected.getL10n());
  typeButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View view){
      openContextMenu(view);
    }
  }
);
  final Button dateButton=(Button)findViewById(R.id.date);
  dateButton.setText(cgBase.formatShortDate(date.getTime().getTime()));
  dateButton.setOnClickListener(new DateListener());
  final EditText logView=(EditText)findViewById(R.id.log);
  if (StringUtils.isBlank(logView.getText()) && StringUtils.isNotBlank(text)) {
    logView.setText(text);
  }
  tweetCheck.setChecked(true);
  final ActivityState lastState=(ActivityState)getLastNonConfigurationInstance();
  if (lastState != null) {
    lastState.restore(this);
  }
  if (cgBase.isEmpty(viewstates)) {
    enablePostButton(false);
    new LoadDataThread().start();
  }
 else {
    enablePostButton(true);
  }
  saveButton.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      saveLog(true);
    }
  }
);
  clearButton.setOnClickListener(new ClearListener());
}
