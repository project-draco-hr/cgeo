{
  final List<File> list=new ArrayList<File>();
  try {
    if (Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED)) {
      boolean loaded=false;
      for (      final File dir : getBaseFolders()) {
        if (dir.exists() && dir.isDirectory()) {
          listDir(list,dir);
          if (!list.isEmpty()) {
            loaded=true;
            break;
          }
        }
      }
      if (!loaded) {
        changeWaitDialogHandler.sendMessage(Message.obtain(changeWaitDialogHandler,MSG_SEARCH_WHOLE_SD_CARD,Environment.getExternalStorageDirectory().getName()));
        listDirs(list,getStorages());
      }
    }
 else {
      Log.w("No external media mounted.");
    }
  }
 catch (  Exception e) {
    Log.e("cgFileList.loadFiles.run: " + e.toString());
  }
  changeWaitDialogHandler.sendMessage(Message.obtain(changeWaitDialogHandler,0,"loaded directories"));
  files.addAll(list);
  Collections.sort(files,new Comparator<File>(){
    @Override public int compare(    File lhs,    File rhs){
      return lhs.getName().compareToIgnoreCase(rhs.getName());
    }
  }
);
  loadFilesHandler.sendMessage(Message.obtain(loadFilesHandler));
}
