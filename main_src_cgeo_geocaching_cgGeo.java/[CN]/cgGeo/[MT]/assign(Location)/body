{
  if (loc == null) {
    locationProvider=LocationProviderType.LAST;
    return;
  }
  location=loc;
  String provider=location.getProvider();
  if (provider.equals(LocationManager.GPS_PROVIDER)) {
    locationProvider=LocationProviderType.GPS;
  }
 else   if (provider.equals(LocationManager.NETWORK_PROVIDER)) {
    locationProvider=LocationProviderType.NETWORK;
  }
 else   if (provider.equalsIgnoreCase("last")) {
    locationProvider=LocationProviderType.LAST;
  }
  coordsNow=new Geopoint(location.getLatitude(),location.getLongitude());
  app.setLastLoc(coordsNow);
  if (location.hasAltitude() && locationProvider != LocationProviderType.LAST) {
    altitudeNow=location.getAltitude() + Settings.getAltCorrection();
  }
 else {
    altitudeNow=null;
  }
  if (location.hasBearing() && locationProvider != LocationProviderType.LAST) {
    bearingNow=location.getBearing();
  }
 else {
    bearingNow=0f;
  }
  if (location.hasSpeed() && locationProvider != LocationProviderType.LAST) {
    speedNow=location.getSpeed();
  }
 else {
    speedNow=0f;
  }
  if (location.hasAccuracy() && locationProvider != LocationProviderType.LAST) {
    accuracyNow=location.getAccuracy();
  }
 else {
    accuracyNow=999f;
  }
  if (locationProvider == LocationProviderType.GPS) {
    if (coordsBefore != null) {
      final float dst=coordsBefore.distanceTo(coordsNow);
      if (dst > 0.005) {
        distanceNow+=dst;
        coordsBefore=coordsNow;
      }
    }
 else     if (coordsBefore == null) {
      coordsBefore=coordsNow;
    }
  }
  if (geoUpdate != null) {
    geoUpdate.updateLoc(this);
  }
  if (locationProvider == LocationProviderType.GPS || locationProvider == LocationProviderType.NETWORK) {
    Go4Cache.signalCoordinates(coordsNow);
  }
}
