{
  final StringBuilder where=new StringBuilder(buildCoordinateWhere(dbTableWaypoints,viewport));
  if (excludeMine) {
    where.append(" and ").append(dbTableCaches).append(".own == 0 and ").append(dbTableCaches).append(".found == 0 ");
  }
  if (excludeDisabled) {
    where.append(" and ").append(dbTableCaches).append(".disabled == 0 ");
  }
  init();
  final StringBuilder query=new StringBuilder("SELECT ");
  for (int i=0; i < WAYPOINT_COLUMNS.length; i++) {
    query.append(i > 0 ? ", " : "").append(dbTableWaypoints).append('.').append(WAYPOINT_COLUMNS[i]).append(' ');
  }
  query.append(" FROM ").append(dbTableWaypoints).append(", ").append(dbTableCaches).append(" WHERE ").append(dbTableWaypoints).append("._id == ").append(dbTableCaches).append("._id and ").append(where);
  final Cursor cursor=databaseRO.rawQuery(query.toString(),null);
  try {
    if (!cursor.moveToFirst()) {
      return Collections.emptySet();
    }
    final Set<cgWaypoint> waypoints=new HashSet<cgWaypoint>();
    do {
      waypoints.add(createWaypointFromDatabaseContent(cursor));
    }
 while (cursor.moveToNext());
    return waypoints;
  }
  finally {
    cursor.close();
  }
}
