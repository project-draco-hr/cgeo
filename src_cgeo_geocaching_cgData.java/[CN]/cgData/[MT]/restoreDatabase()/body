{
  if (Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED) == false) {
    Log.w(cgSettings.tag,"Database wasn't restored: no external memory");
    return false;
  }
  closeDb();
  boolean restoreDone=false;
  final String directoryImg=cgSettings.cache;
  final String fileSource=Environment.getExternalStorageDirectory() + "/" + directoryImg+ "/cgeo.sqlite";
  final String fileTarget=path;
  File fileSourceFile=new File(fileSource);
  if (fileSourceFile.exists() == false) {
    Log.w(cgSettings.tag,"Database backup was not found");
    init();
    return restoreDone;
  }
  InputStream input=null;
  OutputStream output=null;
  try {
    input=new FileInputStream(fileSource);
    output=new FileOutputStream(fileTarget);
  }
 catch (  FileNotFoundException e) {
    Log.e(cgSettings.tag,"Database wasn't restored, could not open file: " + e.toString());
  }
  byte[] buffer=new byte[1024];
  int length;
  if ((input != null) && (output != null)) {
    try {
      while ((length=input.read(buffer)) > 0) {
        output.write(buffer,0,length);
      }
      output.flush();
      restoreDone=true;
    }
 catch (    IOException e) {
      Log.e(cgSettings.tag,"Database wasn't restored, could not read/write file: " + e.toString());
    }
  }
  try {
    if (output != null)     output.close();
    if (input != null)     input.close();
  }
 catch (  IOException e) {
    Log.e(cgSettings.tag,"Database wasn't restored, could not close file: " + e.toString());
  }
  if (restoreDone)   Log.i(cgSettings.tag,"Database was restored");
  init();
  return restoreDone;
}
