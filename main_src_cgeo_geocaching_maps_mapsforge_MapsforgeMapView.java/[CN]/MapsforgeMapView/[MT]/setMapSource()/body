{
  MapGeneratorInternal newMapType=MapGeneratorInternal.MAPNIK;
  final MapSource mapSource=MapProviderFactory.getMapSource(Settings.getMapSource());
  if (mapSource instanceof MapsforgeMapSource) {
    newMapType=((MapsforgeMapSource)mapSource).getGenerator();
  }
  MapGenerator mapGenerator=MapGeneratorFactory.createMapGenerator(newMapType);
  setMapGenerator(mapGenerator);
  if (!mapGenerator.requiresInternetConnection()) {
    setMapFile(new File(Settings.getMapFile()));
    if (!Settings.isValidMapFile(Settings.getMapFile())) {
      Toast.makeText(getContext(),getContext().getResources().getString(R.string.warn_invalid_mapfile),Toast.LENGTH_LONG).show();
    }
  }
}
