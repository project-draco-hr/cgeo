{
  final int id=item.getItemId();
  ContextMenu.ContextMenuInfo info=item.getMenuInfo();
  if (info == null) {
    info=lastMenuInfo;
    lastMenuInfo=null;
  }
  AdapterContextMenuInfo adapterInfo=null;
  try {
    adapterInfo=(AdapterContextMenuInfo)info;
  }
 catch (  Exception e) {
    Log.w(Settings.tag,"cgeocaches.onContextItemSelected: " + e.toString());
  }
  if (id == MENU_COMPASS) {
    final Intent navigateIntent=new Intent(this,cgeonavigate.class);
    final cgCache cache=getCacheFromAdapter(adapterInfo);
    navigateIntent.putExtra("latitude",cache.getCoords().getLatitude());
    navigateIntent.putExtra("longitude",cache.getCoords().getLongitude());
    navigateIntent.putExtra("geocode",cache.getGeocode().toUpperCase());
    navigateIntent.putExtra("name",cache.getName());
    startActivity(navigateIntent);
    return true;
  }
 else   if (id == MENU_LOG_VISIT) {
    return getCacheFromAdapter(adapterInfo).logVisit(this);
  }
 else   if (id == MENU_CACHE_DETAILS) {
    final Intent cachesIntent=new Intent(this,CacheDetailActivity.class);
    final cgCache cache=getCacheFromAdapter(adapterInfo);
    cachesIntent.putExtra("geocode",cache.getGeocode().toUpperCase());
    cachesIntent.putExtra("name",cache.getName());
    startActivity(cachesIntent);
    return true;
  }
 else   if (id == MENU_DROP_CACHE) {
    cgBase.dropCache(app,getCacheFromAdapter(adapterInfo),new Handler(){
      @Override public void handleMessage(      Message msg){
        refreshCurrentList();
      }
    }
);
    return true;
  }
 else   if (id >= CONTEXT_MENU_MOVE_TO_LIST && id < CONTEXT_MENU_MOVE_TO_LIST + 100) {
    final int newListId=id - CONTEXT_MENU_MOVE_TO_LIST;
    if (adapterInfo != null) {
      app.moveToList(getCacheFromAdapter(adapterInfo).getGeocode(),newListId);
    }
    adapter.resetChecks();
    refreshCurrentList();
    return true;
  }
  lastMenuInfo=info;
  if (adapterInfo != null) {
    final cgCache cache=getCacheFromAdapter(adapterInfo);
    final cgSearch singleSearch=cgBase.searchByGeocode(cache.getGeocode(),null,0,false,null);
    if (NavigationAppFactory.onMenuItemSelected(item,geo,this,res,cache,singleSearch,null,null)) {
      return true;
    }
    int logType=id - MENU_LOG_VISIT_OFFLINE;
    cache.logOffline(this,LogType.getById(logType));
  }
  return true;
}
