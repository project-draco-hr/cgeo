{
  ContextMenu.ContextMenuInfo info=item.getMenuInfo();
  if (info == null) {
    info=lastMenuInfo;
    lastMenuInfo=null;
  }
  AdapterContextMenuInfo adapterInfo=null;
  try {
    adapterInfo=(AdapterContextMenuInfo)info;
  }
 catch (  Exception e) {
    Log.w("cgeocaches.onContextItemSelected: " + e.toString());
  }
  final cgCache cache=adapterInfo != null ? getCacheFromAdapter(adapterInfo) : null;
  if (cache == null) {
    return true;
  }
  final int id=item.getItemId();
switch (id) {
case MENU_DEFAULT_NAVIGATION:
    NavigationAppFactory.startDefaultNavigationApplication(app.currentGeo(),this,cache,null,null);
  break;
case MENU_NAVIGATION:
NavigationAppFactory.showNavigationMenu(app.currentGeo(),this,cache,null,null);
break;
case MENU_LOG_VISIT:
cache.logVisit(this);
break;
case MENU_CACHE_DETAILS:
final Intent cachesIntent=new Intent(this,CacheDetailActivity.class);
cachesIntent.putExtra("geocode",cache.getGeocode().toUpperCase());
cachesIntent.putExtra("name",cache.getName());
startActivity(cachesIntent);
break;
case MENU_DROP_CACHE:
cache.drop(new Handler(){
@Override public void handleMessage(Message msg){
refreshCurrentList();
}
}
);
break;
case MENU_MOVE_TO_LIST:
new StoredList.UserInterface(this).promptForListSelection(R.string.cache_menu_move_list,new RunnableWithArgument<Integer>(){
@Override public void run(Integer newListId){
app.moveToList(Collections.singletonList(cache),newListId);
adapter.setSelectMode(false);
refreshCurrentList();
}
}
);
break;
case MENU_STORE_CACHE:
cache.store(this,null);
break;
default :
lastMenuInfo=info;
cache.logOffline(this,LogType.getById(id - MENU_LOG_VISIT_OFFLINE));
}
return true;
}
