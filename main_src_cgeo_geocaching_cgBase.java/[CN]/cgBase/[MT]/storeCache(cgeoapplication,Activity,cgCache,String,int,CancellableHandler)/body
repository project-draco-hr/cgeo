{
  try {
    if (cache != null) {
      if (cache.getReason() > 0 || StringUtils.isBlank(cache.getDescription())) {
        final cgSearch search=searchByGeocode(cache.getGeocode(),null,listId,false,null);
        cache=app.getCache(search);
      }
    }
 else     if (StringUtils.isNotBlank(geocode)) {
      final cgSearch search=searchByGeocode(geocode,null,listId,false,null);
      cache=app.getCache(search);
    }
    if (cache == null) {
      if (handler != null) {
        handler.sendMessage(new Message());
      }
      return;
    }
    if (CancellableHandler.isCancelled(handler)) {
      return;
    }
    final cgHtmlImg imgGetter=new cgHtmlImg(activity,cache.getGeocode(),false,listId,true);
    if (StringUtils.isNotBlank(cache.getDescription())) {
      Html.fromHtml(cache.getDescription(),imgGetter,null);
    }
    if (CancellableHandler.isCancelled(handler)) {
      return;
    }
    if (CollectionUtils.isNotEmpty(cache.getSpoilers())) {
      for (      cgImage oneSpoiler : cache.getSpoilers()) {
        imgGetter.getDrawable(oneSpoiler.url);
      }
    }
    if (CancellableHandler.isCancelled(handler)) {
      return;
    }
    if (Settings.isStoreLogImages() && cache.getLogs() != null) {
      for (      cgLog log : cache.getLogs()) {
        if (CollectionUtils.isNotEmpty(log.logImages)) {
          for (          cgImage oneLogImg : log.logImages) {
            imgGetter.getDrawable(oneLogImg.url);
          }
        }
      }
    }
    if (CancellableHandler.isCancelled(handler)) {
      return;
    }
    StaticMapsProvider.downloadMaps(cache,activity);
    if (CancellableHandler.isCancelled(handler)) {
      return;
    }
    app.markStored(cache.getGeocode(),listId);
    app.removeCacheFromCache(cache.getGeocode());
    if (handler != null) {
      handler.sendMessage(new Message());
    }
  }
 catch (  Exception e) {
    Log.e(Settings.tag,"cgBase.storeCache");
  }
}
