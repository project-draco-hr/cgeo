{
  HttpResponse loginResponse=null;
  String loginData=null;
  String[] viewstates=null;
  final ImmutablePair<String,String> loginStart=settings.getLogin();
  if (loginStart == null) {
    return -3;
  }
  loginResponse=request("https://www.geocaching.com/login/default.aspx",new HashMap<String,String>(),false,false,false);
  loginData=getResponseData(loginResponse);
  if (StringUtils.isNotBlank(loginData)) {
    if (checkLogin(loginData)) {
      Log.i(cgSettings.tag,"Already logged in Geocaching.com as " + loginStart.left);
      switchToEnglish(viewstates);
      return 1;
    }
    viewstates=getViewstates(loginData);
    if (isEmpty(viewstates)) {
      Log.e(cgSettings.tag,"cgeoBase.login: Failed to find viewstates");
      return -1;
    }
  }
 else {
    Log.e(cgSettings.tag,"cgeoBase.login: Failed to retrieve login page (1st)");
    return -2;
  }
  final ImmutablePair<String,String> login=settings.getLogin();
  if (login == null || StringUtils.isEmpty(login.left) || StringUtils.isEmpty(login.right)) {
    Log.e(cgSettings.tag,"cgeoBase.login: No login information stored");
    return -3;
  }
  clearCookies();
  final Parameters params=new Parameters();
  params.put("__EVENTTARGET","");
  params.put("__EVENTARGUMENT","");
  setViewstates(viewstates,params);
  params.put("ctl00$SiteContent$tbUsername",login.left);
  params.put("ctl00$SiteContent$tbPassword",login.right);
  params.put("ctl00$SiteContent$cbRememberMe","on");
  params.put("ctl00$SiteContent$btnSignIn","Login");
  loginResponse=postRequest("https://www.geocaching.com/login/default.aspx",params);
  loginData=getResponseData(loginResponse);
  if (StringUtils.isNotBlank(loginData)) {
    if (checkLogin(loginData)) {
      Log.i(cgSettings.tag,"Successfully logged in Geocaching.com as " + login.left);
      switchToEnglish(getViewstates(loginData));
      return 1;
    }
 else {
      if (loginData.contains("Your username/password combination does not match.")) {
        Log.i(cgSettings.tag,"Failed to log in Geocaching.com as " + login.left + " because of wrong username/password");
        return -6;
      }
 else {
        Log.i(cgSettings.tag,"Failed to log in Geocaching.com as " + login.left + " for some unknown reason");
        return -4;
      }
    }
  }
 else {
    Log.e(cgSettings.tag,"cgeoBase.login: Failed to retrieve login page (2nd)");
    return -5;
  }
}
