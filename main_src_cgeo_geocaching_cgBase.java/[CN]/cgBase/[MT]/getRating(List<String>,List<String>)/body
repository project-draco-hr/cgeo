{
  if (guids == null && geocodes == null) {
    return null;
  }
  final Map<String,cgRating> ratings=new HashMap<String,cgRating>();
  try {
    final Map<String,String> params=new HashMap<String,String>();
    if (settings.isLogin()) {
      final Map<String,String> login=settings.getGCvoteLogin();
      if (login != null) {
        params.put("userName",login.get("username"));
        params.put("password",login.get("password"));
      }
    }
    if (CollectionUtils.isNotEmpty(guids)) {
      params.put("cacheIds",StringUtils.join(guids.toArray(),','));
    }
 else {
      params.put("waypoints",StringUtils.join(geocodes.toArray(),','));
    }
    params.put("version","cgeo");
    final String votes=getResponseData(request(URI_GCVOTE_GETVOTES,params,false,false,false));
    if (votes == null) {
      return null;
    }
    final Pattern patternLogIn=Pattern.compile("loggedIn='([^']+)'",Pattern.CASE_INSENSITIVE);
    final Pattern patternGuid=Pattern.compile("cacheId='([^']+)'",Pattern.CASE_INSENSITIVE);
    final Pattern patternRating=Pattern.compile("voteAvg='([0-9.]+)'",Pattern.CASE_INSENSITIVE);
    final Pattern patternVotes=Pattern.compile("voteCnt='([0-9]+)'",Pattern.CASE_INSENSITIVE);
    final Pattern patternVote=Pattern.compile("voteUser='([0-9.]+)'",Pattern.CASE_INSENSITIVE);
    String voteData=null;
    final Pattern patternVoteElement=Pattern.compile("<vote ([^>]+)>",Pattern.CASE_INSENSITIVE);
    final Matcher matcherVoteElement=patternVoteElement.matcher(votes);
    while (matcherVoteElement.find()) {
      if (matcherVoteElement.groupCount() > 0) {
        voteData=matcherVoteElement.group(1);
      }
      if (voteData == null) {
        continue;
      }
      String guid=null;
      cgRating rating=new cgRating();
      boolean loggedIn=false;
      try {
        final Matcher matcherGuid=patternGuid.matcher(voteData);
        if (matcherGuid.find()) {
          if (matcherGuid.groupCount() > 0) {
            guid=(String)matcherGuid.group(1);
          }
        }
      }
 catch (      Exception e) {
        Log.w(cgSettings.tag,"cgBase.getRating: Failed to parse guid");
      }
      try {
        final Matcher matcherLoggedIn=patternLogIn.matcher(votes);
        if (matcherLoggedIn.find()) {
          if (matcherLoggedIn.groupCount() > 0) {
            if (matcherLoggedIn.group(1).equalsIgnoreCase("true")) {
              loggedIn=true;
            }
          }
        }
      }
 catch (      Exception e) {
        Log.w(cgSettings.tag,"cgBase.getRating: Failed to parse loggedIn");
      }
      try {
        final Matcher matcherRating=patternRating.matcher(voteData);
        if (matcherRating.find()) {
          if (matcherRating.groupCount() > 0) {
            rating.rating=Float.parseFloat(matcherRating.group(1));
          }
        }
      }
 catch (      Exception e) {
        Log.w(cgSettings.tag,"cgBase.getRating: Failed to parse rating");
      }
      try {
        final Matcher matcherVotes=patternVotes.matcher(voteData);
        if (matcherVotes.find()) {
          if (matcherVotes.groupCount() > 0) {
            rating.votes=Integer.parseInt(matcherVotes.group(1));
          }
        }
      }
 catch (      Exception e) {
        Log.w(cgSettings.tag,"cgBase.getRating: Failed to parse vote count");
      }
      if (loggedIn) {
        try {
          final Matcher matcherVote=patternVote.matcher(voteData);
          if (matcherVote.find()) {
            if (matcherVote.groupCount() > 0) {
              rating.myVote=Float.parseFloat(matcherVote.group(1));
            }
          }
        }
 catch (        Exception e) {
          Log.w(cgSettings.tag,"cgBase.getRating: Failed to parse user's vote");
        }
      }
      if (StringUtils.isNotBlank(guid)) {
        ratings.put(guid,rating);
      }
    }
  }
 catch (  Exception e) {
    Log.e(cgSettings.tag,"cgBase.getRating: " + e.toString());
  }
  return ratings;
}
