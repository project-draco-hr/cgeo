{
  cgeoapplication app=cgeoapplication.getInstance();
  int listId1=-1;
  int listId2=-1;
  final cgCache cache1=cgBaseTest.createCache(0);
  assertNotNull(cache1);
  final cgCache cache2=cgBaseTest.createCache(1);
  assertNotNull(cache2);
  try {
    listId1=app.createList("cgData Test");
    assertTrue(listId1 > StoredList.STANDARD_LIST_ID);
    listId2=app.createList("cgDataTest");
    assertTrue(listId2 > StoredList.STANDARD_LIST_ID);
    assertTrue(app.getLists().size() >= 2);
    cache1.setDetailed(true);
    cache1.setListId(listId1);
    cache2.setDetailed(true);
    cache2.setListId(listId1);
    SearchResult searchResult=new SearchResult();
    app.addCacheToSearch(searchResult,cache1);
    app.addCacheToSearch(searchResult,cache2);
    assertTrue(app.getAllStoredCachesCount(false,CacheType.ALL,null) >= 2);
    assertEquals(1,app.renameList(listId1,"cgData Test (renamed)"));
    StoredList list1=app.getList(listId1);
    assertEquals("cgData Test (renamed)",list1.title);
    app.moveToList(cache1.getGeocode(),listId2);
    assertEquals(1,app.getAllStoredCachesCount(false,CacheType.ALL,listId2));
    assertTrue(app.removeList(listId1));
    assertTrue(app.markDropped(cache2.getGeocode()));
    app.markStored(cache2.getGeocode(),listId2);
    StoredList list2=app.getList(listId2);
    app.dropStored(listId2);
  }
  finally {
    List<String> geocodes=new ArrayList<String>();
    geocodes.add(cache1.getGeocode());
    geocodes.add(cache2.getGeocode());
    app.dropCaches(geocodes);
    app.removeList(listId1);
    app.removeList(listId2);
  }
}
