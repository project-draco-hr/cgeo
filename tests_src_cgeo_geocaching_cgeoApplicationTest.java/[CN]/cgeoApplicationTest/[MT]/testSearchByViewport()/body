{
  Strategy strategy=Settings.getLiveMapStrategy();
  try {
    GC2CJPF mockedCache=new GC2CJPF();
    deleteCacheFromDB(mockedCache.getGeocode());
    final String tokens[]=GCBase.getTokens();
    final Viewport viewport=new Viewport(mockedCache.getCoords(),0.003,0.003);
    Settings.setLiveMapStrategy(Strategy.DETAILED);
    SearchResult search=ConnectorFactory.searchByViewport(viewport,tokens);
    assertNotNull(search);
    assertTrue(search.getGeocodes().contains(mockedCache.getGeocode()));
    cgCache parsedCache=cgeoapplication.getInstance().loadCache(mockedCache.getGeocode(),LoadFlags.LOAD_CACHE_OR_DB);
    assertEquals(Settings.isPremiumMember(),mockedCache.getCoords().isEqualTo(parsedCache.getCoords()));
    assertEquals(Settings.isPremiumMember(),parsedCache.isReliableLatLon());
    Settings.setLiveMapStrategy(Strategy.FAST);
    search=ConnectorFactory.searchByViewport(viewport,tokens);
    assertNotNull(search);
    assertTrue(search.getGeocodes().contains(mockedCache.getGeocode()));
    parsedCache=cgeoapplication.getInstance().loadCache(mockedCache.getGeocode(),LoadFlags.LOAD_CACHE_OR_DB);
    assertEquals(Settings.isPremiumMember(),mockedCache.getCoords().isEqualTo(parsedCache.getCoords()));
    assertEquals(Settings.isPremiumMember(),parsedCache.isReliableLatLon());
  }
  finally {
    Settings.setLiveMapStrategy(strategy);
  }
}
