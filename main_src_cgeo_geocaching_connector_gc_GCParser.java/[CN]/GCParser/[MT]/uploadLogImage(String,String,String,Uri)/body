{
  final String uri=new Uri.Builder().scheme("http").authority("www.geocaching.com").path("/seek/upload.aspx").encodedQuery("LID=" + logId).build().toString();
  String page=Network.getResponseData(Network.getRequest(uri));
  if (!Login.getLoginStatus(page)) {
    final StatusCode loginState=Login.login();
    if (loginState == StatusCode.NO_ERROR) {
      page=Network.getResponseData(Network.getRequest(uri));
    }
 else {
      Log.e("Image upload: No login (error: " + loginState + ')');
      return ImmutablePair.of(StatusCode.NOT_LOGGED_IN,null);
    }
  }
  final String[] viewstates=Login.getViewstates(page);
  final Parameters uploadParams=new Parameters("__EVENTTARGET","","__EVENTARGUMENT","","ctl00$ContentBody$ImageUploadControl1$uxFileCaption",caption,"ctl00$ContentBody$ImageUploadControl1$uxFileDesc",description,"ctl00$ContentBody$ImageUploadControl1$uxUpload","Upload");
  Login.putViewstates(uploadParams,viewstates);
  final File image=new File(imageUri.getPath());
  final String response=Network.getResponseData(Network.postRequest(uri,uploadParams,"ctl00$ContentBody$ImageUploadControl1$uxFileUpload","image/jpeg",image));
  MatcherWrapper matcherUrl=new MatcherWrapper(GCConstants.PATTERN_IMAGE_UPLOAD_URL,response);
  if (matcherUrl.find()) {
    Log.i("Logimage successfully uploaded.");
    final String uploadedImageUrl=matcherUrl.group(1);
    return ImmutablePair.of(StatusCode.NO_ERROR,uploadedImageUrl);
  }
  Log.e("GCParser.uploadLogIMage: Failed to upload image because of unknown error");
  return ImmutablePair.of(StatusCode.LOGIMAGE_POST_ERROR,null);
}
