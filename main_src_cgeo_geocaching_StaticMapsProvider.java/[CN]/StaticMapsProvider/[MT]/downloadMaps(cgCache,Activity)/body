{
  if (!Settings.isStoreOfflineMaps() || cache.getCoords() == null || StringUtils.isBlank(cache.getGeocode())) {
    return;
  }
  final String latlonMap=String.format((Locale)null,"%.6f",cache.getCoords().getLatitude()) + "," + String.format((Locale)null,"%.6f",cache.getCoords().getLongitude());
  final Display display=((WindowManager)activity.getSystemService(Context.WINDOW_SERVICE)).getDefaultDisplay();
  final int maxWidth=display.getWidth() - 25;
  final int maxHeight=display.getHeight() - 25;
  int edge=0;
  if (maxWidth > maxHeight) {
    edge=maxWidth;
  }
 else {
    edge=maxHeight;
  }
  final StringBuilder waypoints=new StringBuilder();
  if (CollectionUtils.isNotEmpty(cache.getWaypoints())) {
    for (    cgWaypoint waypoint : cache.getWaypoints()) {
      if (waypoint.getCoords() == null) {
        continue;
      }
      waypoints.append("&markers=icon%3A");
      waypoints.append(MARKERS_URL);
      waypoints.append("marker_waypoint_");
      waypoints.append(waypoint.getWaypointType() != null ? waypoint.getWaypointType().id : null);
      waypoints.append(".png%7C");
      waypoints.append(String.format((Locale)null,"%.6f",waypoint.getCoords().getLatitude()));
      waypoints.append(',');
      waypoints.append(String.format((Locale)null,"%.6f",waypoint.getCoords().getLongitude()));
    }
  }
  downloadMaps(cache,latlonMap,edge,waypoints.toString());
}
