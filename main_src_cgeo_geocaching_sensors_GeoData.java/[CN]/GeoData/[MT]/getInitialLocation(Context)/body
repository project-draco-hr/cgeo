{
  final LocationManager geoManager=(LocationManager)context.getSystemService(Context.LOCATION_SERVICE);
  if (geoManager != null) {
    try {
      final Location lastGpsLocation=geoManager.getLastKnownLocation(LocationManager.GPS_PROVIDER);
      final Location lastNetworkLocation=geoManager.getLastKnownLocation(LocationManager.NETWORK_PROVIDER);
      final Location bestLocation=best(lastGpsLocation,lastNetworkLocation);
      if (bestLocation != null) {
        bestLocation.setProvider(INITIAL_PROVIDER);
        return new GeoData(bestLocation);
      }
    }
 catch (    final Exception e) {
      Log.e("Error when retrieving last known location",e);
    }
  }
 else {
    Log.w("No LocationManager available");
  }
  final String homeLocationStr=Settings.getHomeLocation();
  if (StringUtils.isNotBlank(homeLocationStr)) {
    try {
      assert(homeLocationStr != null);
      final Geopoint homeLocation=new Geopoint(homeLocationStr);
      Log.i("No last known location available, using home location");
      final Location initialLocation=new Location(HOME_PROVIDER);
      initialLocation.setLatitude(homeLocation.getLatitude());
      initialLocation.setLongitude(homeLocation.getLongitude());
      return new GeoData(initialLocation);
    }
 catch (    final Geopoint.ParseException e) {
      Log.w("Unable to parse home location " + homeLocationStr,e);
    }
  }
  Log.i("No last known location nor home location available");
  return null;
}
