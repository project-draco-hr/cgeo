{
  if (guids == null && geocodes == null) {
    return null;
  }
  final Map<String,GCVoteRating> ratings=new HashMap<String,GCVoteRating>();
  try {
    final Parameters params=new Parameters();
    if (Settings.isLogin()) {
      final ImmutablePair<String,String> login=Settings.getGCvoteLogin();
      if (login != null) {
        params.put("userName",login.left,"password",login.right);
      }
    }
    boolean requestByGuids=true;
    if (guids != null && !guids.isEmpty()) {
      params.put("cacheIds",StringUtils.join(guids.toArray(),','));
    }
 else {
      params.put("waypoints",StringUtils.join(geocodes.toArray(),','));
      requestByGuids=false;
    }
    params.put("version","cgeo");
    final String page=Network.getResponseData(Network.getRequest("http://gcvote.com/getVotes.php",params));
    if (page == null) {
      return null;
    }
    final MatcherWrapper matcherVoteElement=new MatcherWrapper(patternVoteElement,page);
    while (matcherVoteElement.find()) {
      String voteData=matcherVoteElement.group(1);
      if (voteData == null) {
        continue;
      }
      String id=null;
      String guid=null;
      final MatcherWrapper matcherGuid=new MatcherWrapper(patternGuid,voteData);
      if (matcherGuid.find()) {
        if (matcherGuid.groupCount() > 0) {
          guid=matcherGuid.group(1);
          if (requestByGuids) {
            id=guid;
          }
        }
      }
      if (!requestByGuids) {
        final MatcherWrapper matcherWp=new MatcherWrapper(patternWaypoint,voteData);
        if (matcherWp.find()) {
          if (matcherWp.groupCount() > 0) {
            id=matcherWp.group(1);
          }
        }
      }
      if (id == null) {
        continue;
      }
      boolean loggedIn=false;
      final MatcherWrapper matcherLoggedIn=new MatcherWrapper(patternLogIn,page);
      if (matcherLoggedIn.find()) {
        if (matcherLoggedIn.groupCount() > 0) {
          if (matcherLoggedIn.group(1).equalsIgnoreCase("true")) {
            loggedIn=true;
          }
        }
      }
      float rating=0;
      try {
        final MatcherWrapper matcherRating=new MatcherWrapper(patternRating,voteData);
        if (matcherRating.find()) {
          rating=Float.parseFloat(matcherRating.group(1));
        }
      }
 catch (      NumberFormatException e) {
        Log.w("GCVote.getRating: Failed to parse rating");
      }
      if (rating <= 0) {
        continue;
      }
      int votes=-1;
      try {
        final MatcherWrapper matcherVotes=new MatcherWrapper(patternVotes,voteData);
        if (matcherVotes.find()) {
          votes=Integer.parseInt(matcherVotes.group(1));
        }
      }
 catch (      NumberFormatException e) {
        Log.w("GCVote.getRating: Failed to parse vote count");
      }
      if (votes < 0) {
        continue;
      }
      float myVote=0;
      if (loggedIn) {
        try {
          final MatcherWrapper matcherVote=new MatcherWrapper(patternVote,voteData);
          if (matcherVote.find()) {
            myVote=Float.parseFloat(matcherVote.group(1));
          }
        }
 catch (        NumberFormatException e) {
          Log.w("GCVote.getRating: Failed to parse user's vote");
        }
      }
      if (StringUtils.isNotBlank(id)) {
        GCVoteRating gcvoteRating=new GCVoteRating(rating,votes,myVote);
        ratings.put(id,gcvoteRating);
        ratingsCache.put(guid,gcvoteRating);
      }
    }
  }
 catch (  RuntimeException e) {
    Log.e("GCVote.getRating",e);
  }
  return ratings;
}
