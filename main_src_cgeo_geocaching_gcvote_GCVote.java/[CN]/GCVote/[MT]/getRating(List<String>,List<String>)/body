{
  if (guids == null && geocodes == null) {
    return null;
  }
  final Map<String,GCVoteRating> ratings=new HashMap<String,GCVoteRating>();
  try {
    final Parameters params=new Parameters();
    if (Settings.isLogin()) {
      final ImmutablePair<String,String> login=Settings.getGCvoteLogin();
      if (login != null) {
        params.put("userName",login.left,"password",login.right);
      }
    }
    if (CollectionUtils.isNotEmpty(guids)) {
      params.put("cacheIds",StringUtils.join(guids.toArray(),','));
    }
 else {
      params.put("waypoints",StringUtils.join(geocodes.toArray(),','));
    }
    params.put("version","cgeo");
    final String page=cgBase.getResponseData(cgBase.request("http://gcvote.com/getVotes.php",params,false,false,false));
    if (page == null) {
      return null;
    }
    String voteData=null;
    final Matcher matcherVoteElement=patternVoteElement.matcher(page);
    while (matcherVoteElement.find()) {
      voteData=matcherVoteElement.group(1);
      if (voteData == null) {
        continue;
      }
      String guid=null;
      try {
        final Matcher matcherGuid=patternGuid.matcher(voteData);
        if (matcherGuid.find()) {
          if (matcherGuid.groupCount() > 0) {
            guid=matcherGuid.group(1);
          }
        }
      }
 catch (      Exception e) {
        Log.w(Settings.tag,"cgBase.getRating: Failed to parse guid");
      }
      if (guid == null) {
        continue;
      }
      boolean loggedIn=false;
      try {
        final Matcher matcherLoggedIn=patternLogIn.matcher(page);
        if (matcherLoggedIn.find()) {
          if (matcherLoggedIn.groupCount() > 0) {
            if (matcherLoggedIn.group(1).equalsIgnoreCase("true")) {
              loggedIn=true;
            }
          }
        }
      }
 catch (      Exception e) {
        Log.w(Settings.tag,"cgBase.getRating: Failed to parse loggedIn");
      }
      float rating=0;
      try {
        final Matcher matcherRating=patternRating.matcher(voteData);
        if (matcherRating.find()) {
          rating=Float.parseFloat(matcherRating.group(1));
        }
      }
 catch (      Exception e) {
        Log.w(Settings.tag,"cgBase.getRating: Failed to parse rating");
      }
      if (rating <= 0) {
        continue;
      }
      int votes=-1;
      try {
        final Matcher matcherVotes=patternVotes.matcher(voteData);
        if (matcherVotes.find()) {
          votes=Integer.parseInt(matcherVotes.group(1));
        }
      }
 catch (      Exception e) {
        Log.w(Settings.tag,"cgBase.getRating: Failed to parse vote count");
      }
      if (votes < 0) {
        continue;
      }
      Float myVote=null;
      if (loggedIn) {
        try {
          final Matcher matcherVote=patternVote.matcher(voteData);
          if (matcherVote.find()) {
            myVote=Float.parseFloat(matcherVote.group(1));
          }
        }
 catch (        Exception e) {
          Log.w(Settings.tag,"cgBase.getRating: Failed to parse user's vote");
        }
      }
      if (StringUtils.isNotBlank(guid)) {
        GCVoteRating gcvoteRating=new GCVoteRating(rating,votes,myVote);
        ratings.put(guid,gcvoteRating);
      }
    }
  }
 catch (  Exception e) {
    Log.e(Settings.tag,"cgBase.getRating: " + e.toString());
  }
  return ratings;
}
