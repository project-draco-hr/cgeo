{
  final List<StoredList> lists=getSortedLists();
  if (exceptListId > StoredList.TEMPORARY_LIST_ID) {
    StoredList exceptList=DataStore.getList(exceptListId);
    if (exceptList != null) {
      lists.remove(exceptList);
    }
  }
  final List<CharSequence> listsTitle=new ArrayList<CharSequence>();
  for (  StoredList list : lists) {
    listsTitle.add(list.getTitleAndCount());
  }
  if (!onlyConcreteLists) {
    listsTitle.add("<" + res.getString(R.string.list_menu_all_lists) + ">");
  }
  listsTitle.add("<" + res.getString(R.string.list_menu_create) + ">");
  final CharSequence[] items=new CharSequence[listsTitle.size()];
  AlertDialog.Builder builder=new AlertDialog.Builder(activity);
  builder.setTitle(res.getString(titleId));
  builder.setItems(listsTitle.toArray(items),new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialogInterface,    int itemId){
      if (itemId == lists.size() && !onlyConcreteLists) {
        runAfterwards.run(StoredList.ALL_LIST_ID);
      }
 else       if (itemId >= lists.size()) {
        promptForListCreation(runAfterwards,newListName);
      }
 else {
        if (runAfterwards != null) {
          runAfterwards.run(lists.get(itemId).id);
        }
      }
    }
  }
);
  builder.create().show();
}
